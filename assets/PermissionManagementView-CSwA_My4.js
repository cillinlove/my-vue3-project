/* empty css                  */import{P as J}from"./PageLayout-C2MZ-4xL.js";/* empty css                        *//* empty css                 *//* empty css                        *//* empty css                *//* empty css                  */import{d as Z,r as _,a as F,a4 as ee,q as le,t as E,w as t,e,m as ae,l as te,E as oe,f as ne,g as x,L as re,Y as se,h as ue,j as g,x as de,a5 as ie,b as U,a6 as pe,M as me,N as ce,I as ge,v as fe,a7 as be,y as _e,i as I,Q as ve,R as ye,S as Ve,c as we,F as Ce,G as he,T as Pe,W as Ee,V as xe,n as p,X as Ue,p as C,_ as Ie}from"./index-D3HzW_Px.js";import{n as Se,o as ke,p as ze,q as qe,r as Be}from"./api-DmWqOvHR.js";import"./mockData-BJpfVYbw.js";const Fe={class:"operation-buttons"},Te={class:"pagination-container"},Ae={class:"dialog-footer"},Me=Z({__name:"PermissionManagementView",setup(je){const h=_([]),P=_(!1),S=_(0),r=F({name:"",code:"",module:"",type:void 0,status:void 0,page:1,pageSize:10}),f=_(!1),m=_("create"),v=_(),n=F({name:"",code:"",description:"",module:"",type:"menu",path:"",parentId:"",sort:1,status:!0}),T={name:[{required:!0,message:"请输入权限名称",trigger:"blur"},{min:1,max:50,message:"权限名称长度在 1 到 50 个字符",trigger:"blur"}],code:[{required:!0,message:"请输入权限编码",trigger:"blur"},{min:1,max:50,message:"权限编码长度在 1 到 50 个字符",trigger:"blur"}],module:[{required:!0,message:"请输入所属模块",trigger:"blur"},{min:1,max:50,message:"所属模块长度在 1 到 50 个字符",trigger:"blur"}],type:[{required:!0,message:"请选择权限类型",trigger:"change"}],path:[{required:(()=>n.type==="menu"),message:"菜单类型必须输入访问路径",trigger:"blur"}],sort:[{required:!0,message:"请输入排序值",trigger:"blur"}]},A=ee(()=>h.value.filter(o=>m.value==="edit"&&o.id===n.id?!1:o.type==="menu"&&o.status)),c=async()=>{P.value=!0;try{const o=await Se(r);h.value=o.list,S.value=o.total}catch(o){p.error("获取权限列表失败"),console.error("获取权限列表失败:",o)}finally{P.value=!1}},y=()=>{r.page=1,c()},M=()=>{Object.assign(r,{name:"",code:"",module:"",type:void 0,status:void 0,page:1,pageSize:10}),c()},j=o=>{r.pageSize=o,c()},L=o=>{r.page=o,c()},N=()=>{m.value="create",v.value&&v.value.resetFields(),Object.assign(n,{name:"",code:"",description:"",module:"",type:"menu",path:"",parentId:"",sort:1,status:!0}),f.value=!0},O=o=>{m.value="edit",Object.assign(n,{id:o.id,name:o.name,code:o.code,description:o.description,module:o.module,type:o.type,path:o.path||"",parentId:o.parentId||"",sort:o.sort,status:o.status}),f.value=!0},R=async()=>{if(v.value)try{await v.value.validate(),m.value==="create"?(await ke(n),p.success("新增权限成功")):(await ze(n.id,n),p.success("编辑权限成功")),f.value=!1,c()}catch(o){p.error(m.value==="create"?"新增权限失败":"编辑权限失败"),console.error(m.value==="create"?"新增权限失败:":"编辑权限失败:",o)}},$=async o=>{try{await Ue.confirm(`确定要删除权限「${o.name}」吗？此操作不可撤销。`,"删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning",customClass:"delete-confirm-message-box",confirmButtonClass:"delete-confirm-btn",distinguishCancelAndClose:!0,autofocus:!1}),await qe(o.id),p.success("删除权限成功"),c()}catch(l){l!=="cancel"&&l!=="close"&&(p.error("删除权限失败"),console.error("删除权限失败:",l))}},D=async o=>{try{await Be(o.id,o.status),p.success("权限状态切换成功")}catch(l){o.status=!o.status,p.error("权限状态切换失败"),console.error("权限状态切换失败:",l)}};return le(()=>{c()}),(o,l)=>{const i=ne,s=oe,d=se,V=re,b=ue,k=ae,z=de,u=ce,K=ge,q=be,B=_e,Q=me,G=Ve,W=Pe,X=Ee,Y=J,H=pe;return C(),E(Y,{title:"权限管理",actions:[{type:"primary",text:"新增权限",icon:I(xe),onClick:N}]},{default:t(()=>[e(z,{shadow:"never",class:"search-form"},{default:t(()=>[e(k,{inline:!0,onSubmit:te(y,["prevent"])},{default:t(()=>[e(s,{label:"权限名称"},{default:t(()=>[e(i,{modelValue:r.name,"onUpdate:modelValue":l[0]||(l[0]=a=>r.name=a),placeholder:"请输入权限名称",clearable:"",onKeyup:x(y,["enter"])},null,8,["modelValue"])]),_:1}),e(s,{label:"权限编码"},{default:t(()=>[e(i,{modelValue:r.code,"onUpdate:modelValue":l[1]||(l[1]=a=>r.code=a),placeholder:"请输入权限编码",clearable:"",onKeyup:x(y,["enter"])},null,8,["modelValue"])]),_:1}),e(s,{label:"所属模块"},{default:t(()=>[e(i,{modelValue:r.module,"onUpdate:modelValue":l[2]||(l[2]=a=>r.module=a),placeholder:"请输入所属模块",clearable:"",onKeyup:x(y,["enter"])},null,8,["modelValue"])]),_:1}),e(s,{label:"权限类型"},{default:t(()=>[e(V,{modelValue:r.type,"onUpdate:modelValue":l[3]||(l[3]=a=>r.type=a),placeholder:"请选择权限类型",clearable:""},{default:t(()=>[e(d,{label:"菜单",value:"menu"}),e(d,{label:"按钮",value:"button"}),e(d,{label:"API",value:"api"})]),_:1},8,["modelValue"])]),_:1}),e(s,{label:"状态"},{default:t(()=>[e(V,{modelValue:r.status,"onUpdate:modelValue":l[4]||(l[4]=a=>r.status=a),placeholder:"请选择状态",clearable:""},{default:t(()=>[e(d,{label:"启用",value:!0}),e(d,{label:"禁用",value:!1})]),_:1},8,["modelValue"])]),_:1}),e(s,null,{default:t(()=>[e(b,{type:"primary",onClick:y},{default:t(()=>[...l[18]||(l[18]=[g("搜索",-1)])]),_:1}),e(b,{onClick:M},{default:t(()=>[...l[19]||(l[19]=[g("重置",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),e(z,{shadow:"never",class:"table-container"},{default:t(()=>[ie((C(),E(Q,{data:h.value,stripe:"",style:{width:"100%"}},{default:t(()=>[e(u,{prop:"name",label:"权限名称",width:"180"}),e(u,{prop:"code",label:"权限编码",width:"180"}),e(u,{prop:"module",label:"所属模块",width:"150"}),e(u,{prop:"type",label:"权限类型",width:"120",align:"center"},{default:t(a=>[e(K,{type:a.row.type==="menu"?"primary":a.row.type==="button"?"success":"warning"},{default:t(()=>[g(fe(a.row.type==="menu"?"菜单":a.row.type==="button"?"按钮":"API"),1)]),_:2},1032,["type"])]),_:1}),e(u,{prop:"path",label:"访问路径",width:"200"}),e(u,{prop:"description",label:"描述"}),e(u,{prop:"sort",label:"排序",width:"80",align:"center"}),e(u,{prop:"status",label:"状态",width:"100",align:"center"},{default:t(a=>[e(q,{modelValue:a.row.status,"onUpdate:modelValue":w=>a.row.status=w,onChange:w=>D(a.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),e(u,{prop:"createdAt",label:"创建时间",width:"180"}),e(u,{prop:"updatedAt",label:"更新时间",width:"180"}),e(u,{label:"操作",width:"180",fixed:"right",align:"center"},{default:t(a=>[U("div",Fe,[e(b,{type:"primary",size:"small",onClick:w=>O(a.row),disabled:!a.row.status},{default:t(()=>[e(B,null,{default:t(()=>[e(I(ve))]),_:1}),l[20]||(l[20]=g(" 编辑 ",-1))]),_:1},8,["onClick","disabled"]),e(b,{type:"danger",size:"small",onClick:w=>$(a.row)},{default:t(()=>[e(B,null,{default:t(()=>[e(I(ye))]),_:1}),l[21]||(l[21]=g(" 删除 ",-1))]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["data"])),[[H,P.value]]),U("div",Te,[e(G,{"current-page":r.page,"onUpdate:currentPage":l[5]||(l[5]=a=>r.page=a),"page-size":r.pageSize,"onUpdate:pageSize":l[6]||(l[6]=a=>r.pageSize=a),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:S.value,onSizeChange:j,onCurrentChange:L},null,8,["current-page","page-size","total"])])]),_:1}),e(X,{modelValue:f.value,"onUpdate:modelValue":l[17]||(l[17]=a=>f.value=a),title:m.value==="create"?"新增权限":"编辑权限",width:"600px","destroy-on-close":""},{footer:t(()=>[U("span",Ae,[e(b,{onClick:l[16]||(l[16]=a=>f.value=!1)},{default:t(()=>[...l[22]||(l[22]=[g("取消",-1)])]),_:1}),e(b,{type:"primary",onClick:R},{default:t(()=>[...l[23]||(l[23]=[g("确定",-1)])]),_:1})])]),default:t(()=>[e(k,{ref_key:"permissionFormRef",ref:v,model:n,rules:T,"label-position":"top"},{default:t(()=>[e(s,{label:"权限名称",prop:"name"},{default:t(()=>[e(i,{modelValue:n.name,"onUpdate:modelValue":l[7]||(l[7]=a=>n.name=a),placeholder:"请输入权限名称"},null,8,["modelValue"])]),_:1}),e(s,{label:"权限编码",prop:"code"},{default:t(()=>[e(i,{modelValue:n.code,"onUpdate:modelValue":l[8]||(l[8]=a=>n.code=a),placeholder:"请输入权限编码"},null,8,["modelValue"])]),_:1}),e(s,{label:"所属模块",prop:"module"},{default:t(()=>[e(i,{modelValue:n.module,"onUpdate:modelValue":l[9]||(l[9]=a=>n.module=a),placeholder:"请输入所属模块"},null,8,["modelValue"])]),_:1}),e(s,{label:"权限类型",prop:"type"},{default:t(()=>[e(V,{modelValue:n.type,"onUpdate:modelValue":l[10]||(l[10]=a=>n.type=a),placeholder:"请选择权限类型"},{default:t(()=>[e(d,{label:"菜单",value:"menu"}),e(d,{label:"按钮",value:"button"}),e(d,{label:"API",value:"api"})]),_:1},8,["modelValue"])]),_:1}),e(s,{label:"访问路径",prop:"path"},{default:t(()=>[e(i,{modelValue:n.path,"onUpdate:modelValue":l[11]||(l[11]=a=>n.path=a),placeholder:"请输入访问路径（菜单类型必填）"},null,8,["modelValue"])]),_:1}),e(s,{label:"父权限",prop:"parentId"},{default:t(()=>[e(V,{modelValue:n.parentId,"onUpdate:modelValue":l[12]||(l[12]=a=>n.parentId=a),placeholder:"请选择父权限"},{default:t(()=>[e(d,{value:"",label:"无父权限"}),(C(!0),we(he,null,Ce(A.value,a=>(C(),E(d,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(s,{label:"描述",prop:"description"},{default:t(()=>[e(i,{modelValue:n.description,"onUpdate:modelValue":l[13]||(l[13]=a=>n.description=a),type:"textarea",placeholder:"请输入权限描述",rows:"3"},null,8,["modelValue"])]),_:1}),e(s,{label:"排序",prop:"sort"},{default:t(()=>[e(W,{modelValue:n.sort,"onUpdate:modelValue":l[14]||(l[14]=a=>n.sort=a),min:1,max:999,placeholder:"请输入排序值"},null,8,["modelValue"])]),_:1}),e(s,{label:"状态",prop:"status"},{default:t(()=>[e(q,{modelValue:n.status,"onUpdate:modelValue":l[15]||(l[15]=a=>n.status=a)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])]),_:1},8,["actions"])}}}),Xe=Ie(Me,[["__scopeId","data-v-a2a1a2c4"]]);export{Xe as default};
