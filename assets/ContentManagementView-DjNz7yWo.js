/* empty css                  *//* empty css                        *//* empty css                 *//* empty css                        *//* empty css               *//* empty css                */import{d as L,r as f,a as G,q as H,t as J,w as l,e,b as h,m as Q,l as W,E as X,f as Y,g as Z,y as ee,P as te,h as ae,j as p,x as le,A as oe,B as se,Q as ne,v as E,G as re,i as x,H as ie,I as ue,J as de,K as pe,N as me,M as ce,n as _,O as fe,p as ge,_ as ve}from"./index-BSOYK04B.js";import{E as _e,F as ye,G as be,H as we}from"./api-DmWqOvHR.js";import{P as Ve}from"./PageLayout-53LlZDnx.js";import"./mockData-BJpfVYbw.js";const Ce={class:"action-buttons"},he={class:"pagination-container"},Ee={class:"dialog-footer"},xe=L({__name:"ContentManagementView",setup(ze){const r=f({title:"",type:void 0,status:void 0}),n=f({page:1,pageSize:10,total:0}),z=f([]),m=f(!1),g=f(!1),w=f(!1),y=f(),o=G({id:void 0,title:"",type:"article",content:"",status:"draft",sort:0}),M={title:[{required:!0,message:"请输入内容标题",trigger:"blur"},{min:2,max:200,message:"内容标题长度在 2 到 200 个字符之间",trigger:"blur"}],type:[{required:!0,message:"请选择内容类型",trigger:"change"}],content:[{required:!0,message:"请输入内容",trigger:"blur"}],status:[{required:!0,message:"请选择状态",trigger:"change"}]},d=async()=>{try{const s={page:n.value.page,pageSize:n.value.pageSize,title:r.value.title,type:r.value.type,status:r.value.status},t=await _e(s);z.value=t.list,n.value.total=t.total}catch(s){_.error("获取内容列表失败："+(s.message||"未知错误"))}},V=async()=>{n.value.page=1,await d()},D=async()=>{r.value={title:"",type:void 0,status:void 0},n.value.page=1,await d()},I=async s=>{n.value.pageSize=s,await d()},F=s=>{n.value.page=s,d()},P=()=>{g.value=!1,q(),m.value=!0},T=s=>{g.value=!0,Object.assign(o,{id:s.id,title:s.title,type:s.type,content:s.content,status:s.status,sort:s.sort}),m.value=!0},q=()=>{o.id=void 0,o.title="",o.type="article",o.content="",o.status="draft",o.sort=0,y.value&&y.value.resetFields()},N=async()=>{if(y.value)try{if(await y.value.validate(),w.value=!0,g.value&&o.id){const s={id:o.id,title:o.title,type:o.type,content:o.content,status:o.status,sort:o.sort};await ye(s),m.value=!1,_.success("内容更新成功"),await d()}else{const s={title:o.title,type:o.type,content:o.content,status:o.status,sort:o.sort};await be(s),m.value=!1,_.success("内容创建成功"),await d()}}catch(s){s!==!1&&(_.error(g.value?"更新内容失败":"创建内容失败"),console.error(s))}finally{w.value=!1}},O=async s=>{try{await fe.confirm(`确定要删除内容「${s.title}」吗？此操作不可撤销。`,"删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning",closeOnClickModal:!1,closeOnPressEscape:!1,showClose:!1}),await we(s.id),await d(),_.success("删除成功")}catch(t){t!=="cancel"&&t!=="close"&&(_.error("删除失败："+(t.message||"未知错误")),console.error("删除内容失败:",t))}};return H(()=>{d()}),(s,t)=>{const C=Y,u=X,i=te,b=ee,v=ae,k=Q,S=le,c=se,U=ne,B=re,R=oe,$=de,j=pe,A=me;return ge(),J(Ve,{title:"内容管理",actions:[{type:"primary",text:"新增内容",icon:x(ce),onClick:P}]},{default:l(()=>[e(S,{shadow:"never",class:"search-form"},{default:l(()=>[e(k,{inline:!0,onSubmit:W(V,["prevent"])},{default:l(()=>[e(u,{label:"内容标题"},{default:l(()=>[e(C,{modelValue:r.value.title,"onUpdate:modelValue":t[0]||(t[0]=a=>r.value.title=a),placeholder:"请输入内容标题",clearable:"",onKeyup:Z(V,["enter"])},null,8,["modelValue"])]),_:1}),e(u,{label:"内容类型"},{default:l(()=>[e(b,{modelValue:r.value.type,"onUpdate:modelValue":t[1]||(t[1]=a=>r.value.type=a),placeholder:"请选择内容类型",clearable:""},{default:l(()=>[e(i,{label:"文章",value:"article"}),e(i,{label:"横幅",value:"banner"}),e(i,{label:"公告",value:"notice"})]),_:1},8,["modelValue"])]),_:1}),e(u,{label:"内容状态"},{default:l(()=>[e(b,{modelValue:r.value.status,"onUpdate:modelValue":t[2]||(t[2]=a=>r.value.status=a),placeholder:"请选择内容状态",clearable:""},{default:l(()=>[e(i,{label:"草稿",value:"draft"}),e(i,{label:"已发布",value:"published"})]),_:1},8,["modelValue"])]),_:1}),e(u,null,{default:l(()=>[e(v,{type:"primary",onClick:V},{default:l(()=>[...t[12]||(t[12]=[p("搜索",-1)])]),_:1}),e(v,{onClick:D},{default:l(()=>[...t[13]||(t[13]=[p("重置",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),e(S,{shadow:"never",class:"table-container"},{default:l(()=>[e(R,{data:z.value,border:"",style:{width:"100%"}},{default:l(()=>[e(c,{prop:"id",label:"内容ID",width:"80",align:"center"}),e(c,{prop:"title",label:"内容标题","min-width":"250"}),e(c,{prop:"type",label:"内容类型",width:"120",align:"center"},{default:l(a=>[e(U,{type:a.row.type==="article"?"primary":a.row.type==="banner"?"success":"warning"},{default:l(()=>[p(E(a.row.type==="article"?"文章":a.row.type==="banner"?"横幅":"公告"),1)]),_:2},1032,["type"])]),_:1}),e(c,{prop:"status",label:"状态",width:"100",align:"center"},{default:l(a=>[e(U,{type:a.row.status==="draft"?"warning":a.row.status==="published"?"success":"info"},{default:l(()=>[p(E(a.row.status==="draft"?"草稿":a.row.status==="published"?"已发布":""),1)]),_:2},1032,["type"])]),_:1}),e(c,{prop:"createdAt",label:"创建时间",width:"180"}),e(c,{prop:"sort",label:"排序",width:"80",align:"center"}),e(c,{label:"操作",width:"200",fixed:"right",align:"center"},{default:l(a=>[h("div",Ce,[e(v,{type:"primary",size:"small",onClick:K=>T(a.row)},{default:l(()=>[e(B,null,{default:l(()=>[e(x(ie))]),_:1}),t[14]||(t[14]=p(" 编辑 ",-1))]),_:1},8,["onClick"]),e(v,{type:"danger",size:"small",onClick:K=>O(a.row)},{default:l(()=>[e(B,null,{default:l(()=>[e(x(ue))]),_:1}),t[15]||(t[15]=p(" 删除 ",-1))]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["data"])]),_:1}),h("div",he,[e($,{"current-page":n.value.page,"onUpdate:currentPage":t[3]||(t[3]=a=>n.value.page=a),"page-size":n.value.pageSize,"onUpdate:pageSize":t[4]||(t[4]=a=>n.value.pageSize=a),"page-sizes":[10,20,50,100],total:n.value.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:I,onCurrentChange:F},null,8,["current-page","page-size","total"])]),e(A,{modelValue:m.value,"onUpdate:modelValue":t[11]||(t[11]=a=>m.value=a),title:g.value?"编辑内容":"新增内容",width:"600px","close-on-click-modal":!1},{footer:l(()=>[h("div",Ee,[e(v,{onClick:t[10]||(t[10]=a=>m.value=!1)},{default:l(()=>[...t[16]||(t[16]=[p("取消",-1)])]),_:1}),e(v,{type:"primary",loading:w.value,onClick:N},{default:l(()=>[p(E(g.value?"保存":"创建"),1)]),_:1},8,["loading"])])]),default:l(()=>[e(k,{ref_key:"formRef",ref:y,model:o,rules:M,"label-width":"100px","status-icon":""},{default:l(()=>[e(u,{label:"内容标题",prop:"title"},{default:l(()=>[e(C,{modelValue:o.title,"onUpdate:modelValue":t[5]||(t[5]=a=>o.title=a),placeholder:"请输入内容标题",maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),_:1}),e(u,{label:"内容类型",prop:"type"},{default:l(()=>[e(b,{modelValue:o.type,"onUpdate:modelValue":t[6]||(t[6]=a=>o.type=a),placeholder:"请选择内容类型",style:{width:"100%"}},{default:l(()=>[e(i,{label:"文章",value:"article"}),e(i,{label:"横幅",value:"banner"}),e(i,{label:"公告",value:"notice"})]),_:1},8,["modelValue"])]),_:1}),e(u,{label:"内容状态",prop:"status"},{default:l(()=>[e(b,{modelValue:o.status,"onUpdate:modelValue":t[7]||(t[7]=a=>o.status=a),placeholder:"请选择状态",style:{width:"100%"}},{default:l(()=>[e(i,{label:"草稿",value:"draft"}),e(i,{label:"已发布",value:"published"})]),_:1},8,["modelValue"])]),_:1}),e(u,{label:"排序",prop:"sort"},{default:l(()=>[e(j,{modelValue:o.sort,"onUpdate:modelValue":t[8]||(t[8]=a=>o.sort=a),min:0,max:999,"controls-position":"right"},null,8,["modelValue"])]),_:1}),e(u,{label:"内容",prop:"content"},{default:l(()=>[e(C,{modelValue:o.content,"onUpdate:modelValue":t[9]||(t[9]=a=>o.content=a),type:"textarea",rows:6,placeholder:"请输入内容"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])]),_:1},8,["actions"])}}}),qe=ve(xe,[["__scopeId","data-v-17fd8563"]]);export{qe as default};
