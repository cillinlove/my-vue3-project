/* empty css                  */import{P as Z}from"./PageLayout-53LlZDnx.js";/* empty css                        *//* empty css                 *//* empty css                        *//* empty css               *//* empty css                  *//* empty css                */import{d as W,r as _,a as F,X as ee,q as le,t as E,w as a,e,m as te,l as ae,E as oe,f as ne,g as x,y as re,P as se,h as ue,j as g,x as de,Y as ie,b as U,Z as pe,A as me,B as ce,Q as ge,v as fe,$ as be,G as _e,i as I,H as ve,I as ye,J as Ve,c as we,z as Ce,F as he,K as Pe,N as Ee,M as xe,n as p,O as Ue,p as C,_ as Ie}from"./index-BSOYK04B.js";import{n as ze,o as Se,p as ke,q as Be,r as qe}from"./api-DmWqOvHR.js";import"./mockData-BJpfVYbw.js";const Fe={class:"operation-buttons"},Ae={class:"pagination-container"},Me={class:"dialog-footer"},Te=W({__name:"PermissionManagementView",setup(Oe){const h=_([]),P=_(!1),z=_(0),r=F({name:"",code:"",module:"",type:void 0,status:void 0,page:1,pageSize:10}),f=_(!1),m=_("create"),v=_(),n=F({name:"",code:"",description:"",module:"",type:"menu",path:"",parentId:"",sort:1,status:!0}),A={name:[{required:!0,message:"请输入权限名称",trigger:"blur"},{min:1,max:50,message:"权限名称长度在 1 到 50 个字符",trigger:"blur"}],code:[{required:!0,message:"请输入权限编码",trigger:"blur"},{min:1,max:50,message:"权限编码长度在 1 到 50 个字符",trigger:"blur"}],module:[{required:!0,message:"请输入所属模块",trigger:"blur"},{min:1,max:50,message:"所属模块长度在 1 到 50 个字符",trigger:"blur"}],type:[{required:!0,message:"请选择权限类型",trigger:"change"}],path:[{required:(()=>n.type==="menu"),message:"菜单类型必须输入访问路径",trigger:"blur"}],sort:[{required:!0,message:"请输入排序值",trigger:"blur"}]},M=ee(()=>h.value.filter(o=>m.value==="edit"&&o.id===n.id?!1:o.type==="menu"&&o.status)),c=async()=>{P.value=!0;try{const o=await ze(r);h.value=o.list,z.value=o.total}catch(o){p.error("获取权限列表失败"),console.error("获取权限列表失败:",o)}finally{P.value=!1}},y=()=>{r.page=1,c()},T=()=>{Object.assign(r,{name:"",code:"",module:"",type:void 0,status:void 0,page:1,pageSize:10}),c()},O=o=>{r.pageSize=o,c()},$=o=>{r.page=o,c()},j=()=>{m.value="create",v.value&&v.value.resetFields(),Object.assign(n,{name:"",code:"",description:"",module:"",type:"menu",path:"",parentId:"",sort:1,status:!0}),f.value=!0},K=o=>{m.value="edit",Object.assign(n,{id:o.id,name:o.name,code:o.code,description:o.description,module:o.module,type:o.type,path:o.path||"",parentId:o.parentId||"",sort:o.sort,status:o.status}),f.value=!0},N=async()=>{if(v.value)try{await v.value.validate(),m.value==="create"?(await Se(n),p.success("新增权限成功")):(await ke(n.id,n),p.success("编辑权限成功")),f.value=!1,c()}catch(o){p.error(m.value==="create"?"新增权限失败":"编辑权限失败"),console.error(m.value==="create"?"新增权限失败:":"编辑权限失败:",o)}},D=async o=>{try{await Ue.confirm(`确定要删除权限「${o.name}」吗？此操作不可撤销。`,"删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning",customClass:"delete-confirm-message-box",confirmButtonClass:"delete-confirm-btn",distinguishCancelAndClose:!0,autofocus:!1}),await Be(o.id),p.success("删除权限成功"),c()}catch(l){l!=="cancel"&&l!=="close"&&(p.error("删除权限失败"),console.error("删除权限失败:",l))}},L=async o=>{try{await qe(o.id,o.status),p.success("权限状态切换成功")}catch(l){o.status=!o.status,p.error("权限状态切换失败"),console.error("权限状态切换失败:",l)}};return le(()=>{c()}),(o,l)=>{const i=ne,s=oe,d=se,V=re,b=ue,S=te,k=de,u=ce,R=ge,B=be,q=_e,Q=me,G=Ve,H=Pe,J=Ee,X=Z,Y=pe;return C(),E(X,{title:"权限管理",actions:[{type:"primary",text:"新增权限",icon:I(xe),onClick:j}]},{default:a(()=>[e(k,{shadow:"never",class:"search-form"},{default:a(()=>[e(S,{inline:!0,onSubmit:ae(y,["prevent"])},{default:a(()=>[e(s,{label:"权限名称"},{default:a(()=>[e(i,{modelValue:r.name,"onUpdate:modelValue":l[0]||(l[0]=t=>r.name=t),placeholder:"请输入权限名称",clearable:"",onKeyup:x(y,["enter"])},null,8,["modelValue"])]),_:1}),e(s,{label:"权限编码"},{default:a(()=>[e(i,{modelValue:r.code,"onUpdate:modelValue":l[1]||(l[1]=t=>r.code=t),placeholder:"请输入权限编码",clearable:"",onKeyup:x(y,["enter"])},null,8,["modelValue"])]),_:1}),e(s,{label:"所属模块"},{default:a(()=>[e(i,{modelValue:r.module,"onUpdate:modelValue":l[2]||(l[2]=t=>r.module=t),placeholder:"请输入所属模块",clearable:"",onKeyup:x(y,["enter"])},null,8,["modelValue"])]),_:1}),e(s,{label:"权限类型"},{default:a(()=>[e(V,{modelValue:r.type,"onUpdate:modelValue":l[3]||(l[3]=t=>r.type=t),placeholder:"请选择权限类型",clearable:""},{default:a(()=>[e(d,{label:"菜单",value:"menu"}),e(d,{label:"按钮",value:"button"}),e(d,{label:"API",value:"api"})]),_:1},8,["modelValue"])]),_:1}),e(s,{label:"状态"},{default:a(()=>[e(V,{modelValue:r.status,"onUpdate:modelValue":l[4]||(l[4]=t=>r.status=t),placeholder:"请选择状态",clearable:""},{default:a(()=>[e(d,{label:"启用",value:!0}),e(d,{label:"禁用",value:!1})]),_:1},8,["modelValue"])]),_:1}),e(s,null,{default:a(()=>[e(b,{type:"primary",onClick:y},{default:a(()=>[...l[18]||(l[18]=[g("搜索",-1)])]),_:1}),e(b,{onClick:T},{default:a(()=>[...l[19]||(l[19]=[g("重置",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),e(k,{shadow:"never",class:"table-container"},{default:a(()=>[ie((C(),E(Q,{data:h.value,stripe:"",style:{width:"100%"}},{default:a(()=>[e(u,{prop:"name",label:"权限名称",width:"180"}),e(u,{prop:"code",label:"权限编码",width:"180"}),e(u,{prop:"module",label:"所属模块",width:"150"}),e(u,{prop:"type",label:"权限类型",width:"120",align:"center"},{default:a(t=>[e(R,{type:t.row.type==="menu"?"primary":t.row.type==="button"?"success":"warning"},{default:a(()=>[g(fe(t.row.type==="menu"?"菜单":t.row.type==="button"?"按钮":"API"),1)]),_:2},1032,["type"])]),_:1}),e(u,{prop:"path",label:"访问路径",width:"200"}),e(u,{prop:"description",label:"描述"}),e(u,{prop:"sort",label:"排序",width:"80",align:"center"}),e(u,{prop:"status",label:"状态",width:"100",align:"center"},{default:a(t=>[e(B,{modelValue:t.row.status,"onUpdate:modelValue":w=>t.row.status=w,onChange:w=>L(t.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),e(u,{prop:"createdAt",label:"创建时间",width:"180"}),e(u,{prop:"updatedAt",label:"更新时间",width:"180"}),e(u,{label:"操作",width:"180",fixed:"right",align:"center"},{default:a(t=>[U("div",Fe,[e(b,{type:"primary",size:"small",onClick:w=>K(t.row),disabled:!t.row.status},{default:a(()=>[e(q,null,{default:a(()=>[e(I(ve))]),_:1}),l[20]||(l[20]=g(" 编辑 ",-1))]),_:1},8,["onClick","disabled"]),e(b,{type:"danger",size:"small",onClick:w=>D(t.row)},{default:a(()=>[e(q,null,{default:a(()=>[e(I(ye))]),_:1}),l[21]||(l[21]=g(" 删除 ",-1))]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["data"])),[[Y,P.value]]),U("div",Ae,[e(G,{"current-page":r.page,"onUpdate:currentPage":l[5]||(l[5]=t=>r.page=t),"page-size":r.pageSize,"onUpdate:pageSize":l[6]||(l[6]=t=>r.pageSize=t),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:z.value,onSizeChange:O,onCurrentChange:$},null,8,["current-page","page-size","total"])])]),_:1}),e(J,{modelValue:f.value,"onUpdate:modelValue":l[17]||(l[17]=t=>f.value=t),title:m.value==="create"?"新增权限":"编辑权限",width:"600px","destroy-on-close":""},{footer:a(()=>[U("span",Me,[e(b,{onClick:l[16]||(l[16]=t=>f.value=!1)},{default:a(()=>[...l[22]||(l[22]=[g("取消",-1)])]),_:1}),e(b,{type:"primary",onClick:N},{default:a(()=>[...l[23]||(l[23]=[g("确定",-1)])]),_:1})])]),default:a(()=>[e(S,{ref_key:"permissionFormRef",ref:v,model:n,rules:A,"label-position":"top"},{default:a(()=>[e(s,{label:"权限名称",prop:"name"},{default:a(()=>[e(i,{modelValue:n.name,"onUpdate:modelValue":l[7]||(l[7]=t=>n.name=t),placeholder:"请输入权限名称"},null,8,["modelValue"])]),_:1}),e(s,{label:"权限编码",prop:"code"},{default:a(()=>[e(i,{modelValue:n.code,"onUpdate:modelValue":l[8]||(l[8]=t=>n.code=t),placeholder:"请输入权限编码"},null,8,["modelValue"])]),_:1}),e(s,{label:"所属模块",prop:"module"},{default:a(()=>[e(i,{modelValue:n.module,"onUpdate:modelValue":l[9]||(l[9]=t=>n.module=t),placeholder:"请输入所属模块"},null,8,["modelValue"])]),_:1}),e(s,{label:"权限类型",prop:"type"},{default:a(()=>[e(V,{modelValue:n.type,"onUpdate:modelValue":l[10]||(l[10]=t=>n.type=t),placeholder:"请选择权限类型"},{default:a(()=>[e(d,{label:"菜单",value:"menu"}),e(d,{label:"按钮",value:"button"}),e(d,{label:"API",value:"api"})]),_:1},8,["modelValue"])]),_:1}),e(s,{label:"访问路径",prop:"path"},{default:a(()=>[e(i,{modelValue:n.path,"onUpdate:modelValue":l[11]||(l[11]=t=>n.path=t),placeholder:"请输入访问路径（菜单类型必填）"},null,8,["modelValue"])]),_:1}),e(s,{label:"父权限",prop:"parentId"},{default:a(()=>[e(V,{modelValue:n.parentId,"onUpdate:modelValue":l[12]||(l[12]=t=>n.parentId=t),placeholder:"请选择父权限"},{default:a(()=>[e(d,{value:"",label:"无父权限"}),(C(!0),we(he,null,Ce(M.value,t=>(C(),E(d,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(s,{label:"描述",prop:"description"},{default:a(()=>[e(i,{modelValue:n.description,"onUpdate:modelValue":l[13]||(l[13]=t=>n.description=t),type:"textarea",placeholder:"请输入权限描述",rows:"3"},null,8,["modelValue"])]),_:1}),e(s,{label:"排序",prop:"sort"},{default:a(()=>[e(H,{modelValue:n.sort,"onUpdate:modelValue":l[14]||(l[14]=t=>n.sort=t),min:1,max:999,placeholder:"请输入排序值"},null,8,["modelValue"])]),_:1}),e(s,{label:"状态",prop:"status"},{default:a(()=>[e(B,{modelValue:n.status,"onUpdate:modelValue":l[15]||(l[15]=t=>n.status=t)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])]),_:1},8,["actions"])}}}),Xe=Ie(Te,[["__scopeId","data-v-a2a1a2c4"]]);export{Xe as default};
