import{E as ge}from"./el-button-Vc6VEKII.js";import{E as ve}from"./el-overlay-BzxwWa47.js";import{b as be,E as _e,a as ye}from"./el-input-CFf0CTHR.js";import{E as Ve}from"./el-input-number-BnT4jGWw.js";import{b as xe,h as we,e as Ce,c as he,f as Ee}from"./el-table-column-DnVx5bAE.js";import{E as ke}from"./el-tag-H94PFL3m.js";import{E as Ae}from"./el-card-CgDv5Emn.js";import{E as Ie}from"./el-switch-CGMg5m1i.js";import{p as k,q as H,aL as Pe,d as ae,aM as Se,aN as Be,aH as B,w as s,aG as oe,t as e,aO as Le,U as Ue,aP as O,a9 as ze,a6 as ne,ah as se,aQ as L,aR as J,aS as re,aT as Te,aU as $e,c as Ne,C as Oe,f as W,s as I,x as h,E as Fe,k as K,aE as je,v as G,g as ee,F as qe,aD as Re,at as Me,X as De,ar as Ke,z as E,o as $,B as Ge}from"./index-ClAeb_nj.js";import{i as He,j as Qe,k as Xe,l as Ye,t as Ze}from"./api-D03_kbYf.js";import{E as Je}from"./index-Az46Y9ah.js";import"./index-4rY4zpWs.js";import"./mockData-C7SYYOmC.js";function We(l,r){let o;const c=k(!1),a=H({...l,originalPosition:"",originalOverflow:"",visible:!1});function d(m){a.text=m}function p(){const m=a.parent,V=b.ns;if(!m.vLoadingAddClassList){let _=m.getAttribute("loading-number");_=Number.parseInt(_)-1,_?m.setAttribute("loading-number",_.toString()):(O(m,V.bm("parent","relative")),m.removeAttribute("loading-number")),O(m,V.bm("parent","hidden"))}g(),v.unmount()}function g(){var m,V;(V=(m=b.$el)==null?void 0:m.parentNode)==null||V.removeChild(b.$el)}function i(){var m;l.beforeClose&&!l.beforeClose()||(c.value=!0,clearTimeout(o),o=setTimeout(y,400),a.visible=!1,(m=l.closed)==null||m.call(l))}function y(){if(!c.value)return;const m=a.parent;c.value=!1,m.vLoadingAddClassList=void 0,p()}const S=ae({name:"ElLoading",setup(m,{expose:V}){const{ns:_,zIndex:F}=Be("loading");return V({ns:_,zIndex:F}),()=>{const z=a.spinner||a.svg,j=B("svg",{class:"circular",viewBox:a.svgViewBox?a.svgViewBox:"0 0 50 50",...z?{innerHTML:z}:{}},[B("circle",{class:"path",cx:"25",cy:"25",r:"20",fill:"none"})]),q=a.text?B("p",{class:_.b("text")},[a.text]):void 0;return B(Ue,{name:_.b("fade"),onAfterLeave:y},{default:s(()=>[oe(e("div",{style:{backgroundColor:a.background||""},class:[_.b("mask"),a.customClass,_.is("fullscreen",a.fullscreen)]},[B("div",{class:_.b("spinner")},[j,q])]),[[Le,a.visible]])])})}}}),v=Pe(S);Object.assign(v._context,r??{});const b=v.mount(document.createElement("div"));return{...Se(a),setText:d,removeElLoadingChild:g,close:i,handleAfterLeave:y,vm:b,get $el(){return b.$el}}}let N;const Q=function(l={},r){if(!ze)return;const o=et(l);if(o.fullscreen&&N)return N;const c=We({...o,closed:()=>{var d;(d=o.closed)==null||d.call(o),o.fullscreen&&(N=void 0)}},r??Q._context);tt(o,o.parent,c),te(o,o.parent,c),o.parent.vLoadingAddClassList=()=>te(o,o.parent,c);let a=o.parent.getAttribute("loading-number");return a?a=`${Number.parseInt(a)+1}`:a="1",o.parent.setAttribute("loading-number",a),o.parent.appendChild(c.$el),ne(()=>c.visible.value=o.visible),o.fullscreen&&(N=c),c},et=l=>{var r,o,c,a;let d;return se(l.target)?d=(r=document.querySelector(l.target))!=null?r:document.body:d=l.target||document.body,{parent:d===document.body||l.body?document.body:d,background:l.background||"",svg:l.svg||"",svgViewBox:l.svgViewBox||"",spinner:l.spinner||!1,text:l.text||"",fullscreen:d===document.body&&((o=l.fullscreen)!=null?o:!0),lock:(c=l.lock)!=null?c:!1,customClass:l.customClass||"",visible:(a=l.visible)!=null?a:!0,beforeClose:l.beforeClose,closed:l.closed,target:d}},tt=async(l,r,o)=>{const{nextZIndex:c}=o.vm.zIndex||o.vm._.exposed.zIndex,a={};if(l.fullscreen)o.originalPosition.value=L(document.body,"position"),o.originalOverflow.value=L(document.body,"overflow"),a.zIndex=c();else if(l.parent===document.body){o.originalPosition.value=L(document.body,"position"),await ne();for(const d of["top","left"]){const p=d==="top"?"scrollTop":"scrollLeft";a[d]=`${l.target.getBoundingClientRect()[d]+document.body[p]+document.documentElement[p]-Number.parseInt(L(document.body,`margin-${d}`),10)}px`}for(const d of["height","width"])a[d]=`${l.target.getBoundingClientRect()[d]}px`}else o.originalPosition.value=L(r,"position");for(const[d,p]of Object.entries(a))o.$el.style[d]=p},te=(l,r,o)=>{const c=o.vm.ns||o.vm._.exposed.ns;["absolute","fixed","sticky"].includes(o.originalPosition.value)?O(r,c.bm("parent","relative")):J(r,c.bm("parent","relative")),l.fullscreen&&l.lock?J(r,c.bm("parent","hidden")):O(r,c.bm("parent","hidden"))};Q._context=null;const U=Symbol("ElLoading"),P=l=>`element-loading-${$e(l)}`,le=(l,r)=>{var o,c,a,d;const p=r.instance,g=m=>re(r.value)?r.value[m]:void 0,i=m=>{const V=se(m)&&p?.[m]||m;return k(V)},y=m=>i(g(m)||l.getAttribute(P(m))),S=(o=g("fullscreen"))!=null?o:r.modifiers.fullscreen,v={text:y("text"),svg:y("svg"),svgViewBox:y("svgViewBox"),spinner:y("spinner"),background:y("background"),customClass:y("customClass"),fullscreen:S,target:(c=g("target"))!=null?c:S?void 0:l,body:(a=g("body"))!=null?a:r.modifiers.body,lock:(d=g("lock"))!=null?d:r.modifiers.lock},b=Q(v);b._context=X._context,l[U]={options:v,instance:b}},lt=(l,r)=>{for(const o of Object.keys(l))Te(l[o])&&(l[o].value=r[o])},X={mounted(l,r){r.value&&le(l,r)},updated(l,r){const o=l[U];if(!r.value){o?.instance.close(),l[U]=null;return}o?lt(o.options,re(r.value)?r.value:{text:l.getAttribute(P("text")),svg:l.getAttribute(P("svg")),svgViewBox:l.getAttribute(P("svgViewBox")),spinner:l.getAttribute(P("spinner")),background:l.getAttribute(P("background")),customClass:l.getAttribute(P("customClass"))}):le(l,r)},unmounted(l){var r;(r=l[U])==null||r.instance.close(),l[U]=null}};X._context=null;const at={class:"permission-management"},ot={class:"permission-management-header"},nt={class:"permission-management-filter"},st={class:"permission-management-table"},rt={class:"operation-buttons"},ut={class:"pagination-container"},dt={class:"dialog-footer"},it=ae({__name:"PermissionManagementView",setup(l){const r=k([]),o=k(!1),c=k(0),a=H({name:"",code:"",module:"",type:void 0,status:void 0,page:1,pageSize:10}),d=k(!1),p=k("create"),g=k(),i=H({name:"",code:"",description:"",module:"",type:"menu",path:"",parentId:"",sort:1,status:!0}),y={name:[{required:!0,message:"请输入权限名称",trigger:"blur"},{min:1,max:50,message:"权限名称长度在 1 到 50 个字符",trigger:"blur"}],code:[{required:!0,message:"请输入权限编码",trigger:"blur"},{min:1,max:50,message:"权限编码长度在 1 到 50 个字符",trigger:"blur"}],module:[{required:!0,message:"请输入所属模块",trigger:"blur"},{min:1,max:50,message:"所属模块长度在 1 到 50 个字符",trigger:"blur"}],type:[{required:!0,message:"请选择权限类型",trigger:"change"}],path:[{required:(()=>i.type==="menu"),message:"菜单类型必须输入访问路径",trigger:"blur"}],sort:[{required:!0,message:"请输入排序值",trigger:"blur"}]},S=Ne(()=>r.value.filter(u=>p.value==="edit"&&u.id===i.id?!1:u.type==="menu"&&u.status)),v=async()=>{o.value=!0;try{const u=await He(a);r.value=u.list,c.value=u.total}catch(u){E.error("获取权限列表失败"),console.error("获取权限列表失败:",u)}finally{o.value=!1}},b=()=>{a.page=1,v()},m=()=>{Object.assign(a,{name:"",code:"",module:"",type:void 0,status:void 0,page:1,pageSize:10}),v()},V=u=>{a.pageSize=u,v()},_=u=>{a.page=u,v()},F=()=>{p.value="create",g.value&&g.value.resetFields(),Object.assign(i,{name:"",code:"",description:"",module:"",type:"menu",path:"",parentId:"",sort:1,status:!0}),d.value=!0},z=u=>{p.value="edit",Object.assign(i,{id:u.id,name:u.name,code:u.code,description:u.description,module:u.module,type:u.type,path:u.path||"",parentId:u.parentId||"",sort:u.sort,status:u.status}),d.value=!0},j=async()=>{if(g.value)try{await g.value.validate(),p.value==="create"?(await Qe(i),E.success("新增权限成功")):(await Xe(i.id,i),E.success("编辑权限成功")),d.value=!1,v()}catch(u){E.error(p.value==="create"?"新增权限失败":"编辑权限失败"),console.error(p.value==="create"?"新增权限失败:":"编辑权限失败:",u)}},q=async u=>{try{await Je.confirm(`确定要删除权限「${u.name}」吗？此操作不可撤销。`,"删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning",customClass:"delete-confirm-message-box",confirmButtonClass:"delete-confirm-btn",distinguishCancelAndClose:!0,autofocus:!1}),await Ye(u.id),E.success("删除权限成功"),v()}catch(t){t!=="cancel"&&t!=="close"&&(E.error("删除权限失败"),console.error("删除权限失败:",t))}},ue=async u=>{try{await Ze(u.id,u.status),E.success("权限状态切换成功")}catch(t){u.status=!u.status,E.error("权限状态切换失败"),console.error("权限状态切换失败:",t)}};return Oe(()=>{v()}),(u,t)=>{const R=Fe,A=ge,w=ye,f=_e,C=we,M=xe,D=Ie,Y=be,Z=Ae,x=Ce,de=ke,ie=he,me=Ee,ce=Ve,pe=ve,fe=X;return $(),W("div",at,[I("div",ot,[t[19]||(t[19]=I("h2",null,"权限管理",-1)),e(A,{type:"primary",onClick:F},{default:s(()=>[e(R,null,{default:s(()=>[e(K(je))]),_:1}),t[18]||(t[18]=h(" 新增权限 ",-1))]),_:1})]),I("div",nt,[e(Z,{shadow:"hover"},{default:s(()=>[e(Y,{model:a,layout:"inline",size:"small"},{default:s(()=>[e(f,{label:"权限名称"},{default:s(()=>[e(w,{modelValue:a.name,"onUpdate:modelValue":t[0]||(t[0]=n=>a.name=n),placeholder:"请输入权限名称",clearable:"",onKeyup:G(b,["enter"])},null,8,["modelValue"])]),_:1}),e(f,{label:"权限编码"},{default:s(()=>[e(w,{modelValue:a.code,"onUpdate:modelValue":t[1]||(t[1]=n=>a.code=n),placeholder:"请输入权限编码",clearable:"",onKeyup:G(b,["enter"])},null,8,["modelValue"])]),_:1}),e(f,{label:"所属模块"},{default:s(()=>[e(w,{modelValue:a.module,"onUpdate:modelValue":t[2]||(t[2]=n=>a.module=n),placeholder:"请输入所属模块",clearable:"",onKeyup:G(b,["enter"])},null,8,["modelValue"])]),_:1}),e(f,{label:"权限类型"},{default:s(()=>[e(M,{modelValue:a.type,"onUpdate:modelValue":t[3]||(t[3]=n=>a.type=n),placeholder:"请选择权限类型",clearable:""},{default:s(()=>[e(C,{label:"菜单",value:"menu"}),e(C,{label:"按钮",value:"button"}),e(C,{label:"API",value:"api"})]),_:1},8,["modelValue"])]),_:1}),e(f,{label:"状态"},{default:s(()=>[e(D,{modelValue:a.status,"onUpdate:modelValue":t[4]||(t[4]=n=>a.status=n),"inline-prompt":"","active-text":"启用","inactive-text":"禁用"},null,8,["modelValue"])]),_:1}),e(f,null,{default:s(()=>[e(A,{type:"primary",onClick:b},{default:s(()=>[...t[20]||(t[20]=[h("查询",-1)])]),_:1}),e(A,{onClick:m},{default:s(()=>[...t[21]||(t[21]=[h("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})]),I("div",st,[e(Z,{shadow:"hover"},{default:s(()=>[oe(($(),ee(ie,{data:r.value,style:{width:"100%"},stripe:"",border:"","default-sort":{prop:"sort",order:"ascending"}},{default:s(()=>[e(x,{prop:"name",label:"权限名称",width:"180"}),e(x,{prop:"code",label:"权限编码",width:"180"}),e(x,{prop:"module",label:"所属模块",width:"150"}),e(x,{prop:"type",label:"权限类型",width:"120"},{default:s(n=>[e(de,{type:n.row.type==="menu"?"primary":n.row.type==="button"?"success":"warning"},{default:s(()=>[h(qe(n.row.type==="menu"?"菜单":n.row.type==="button"?"按钮":"API"),1)]),_:2},1032,["type"])]),_:1}),e(x,{prop:"path",label:"访问路径",width:"200"}),e(x,{prop:"description",label:"描述"}),e(x,{prop:"sort",label:"排序",width:"80"}),e(x,{prop:"status",label:"状态",width:"100"},{default:s(n=>[e(D,{modelValue:n.row.status,"onUpdate:modelValue":T=>n.row.status=T,onChange:T=>ue(n.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),e(x,{prop:"createdAt",label:"创建时间",width:"180"}),e(x,{prop:"updatedAt",label:"更新时间",width:"180"}),e(x,{label:"操作",width:"180",fixed:"right"},{default:s(n=>[I("div",rt,[e(A,{type:"primary",size:"small",onClick:T=>z(n.row),disabled:!n.row.status},{default:s(()=>[e(R,null,{default:s(()=>[e(K(Re))]),_:1}),t[22]||(t[22]=h(" 编辑 ",-1))]),_:1},8,["onClick","disabled"]),e(A,{type:"danger",size:"small",onClick:T=>q(n.row)},{default:s(()=>[e(R,null,{default:s(()=>[e(K(Me))]),_:1}),t[23]||(t[23]=h(" 删除 ",-1))]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["data"])),[[fe,o.value]]),I("div",ut,[e(me,{"current-page":a.page,"onUpdate:currentPage":t[5]||(t[5]=n=>a.page=n),"page-size":a.pageSize,"onUpdate:pageSize":t[6]||(t[6]=n=>a.pageSize=n),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:c.value,onSizeChange:V,onCurrentChange:_},null,8,["current-page","page-size","total"])])]),_:1})]),e(pe,{modelValue:d.value,"onUpdate:modelValue":t[17]||(t[17]=n=>d.value=n),title:p.value==="create"?"新增权限":"编辑权限",width:"600px","destroy-on-close":""},{footer:s(()=>[I("span",dt,[e(A,{onClick:t[16]||(t[16]=n=>d.value=!1)},{default:s(()=>[...t[24]||(t[24]=[h("取消",-1)])]),_:1}),e(A,{type:"primary",onClick:j},{default:s(()=>[...t[25]||(t[25]=[h("确定",-1)])]),_:1})])]),default:s(()=>[e(Y,{ref_key:"permissionFormRef",ref:g,model:i,rules:y,"label-position":"top"},{default:s(()=>[e(f,{label:"权限名称",prop:"name"},{default:s(()=>[e(w,{modelValue:i.name,"onUpdate:modelValue":t[7]||(t[7]=n=>i.name=n),placeholder:"请输入权限名称"},null,8,["modelValue"])]),_:1}),e(f,{label:"权限编码",prop:"code"},{default:s(()=>[e(w,{modelValue:i.code,"onUpdate:modelValue":t[8]||(t[8]=n=>i.code=n),placeholder:"请输入权限编码"},null,8,["modelValue"])]),_:1}),e(f,{label:"所属模块",prop:"module"},{default:s(()=>[e(w,{modelValue:i.module,"onUpdate:modelValue":t[9]||(t[9]=n=>i.module=n),placeholder:"请输入所属模块"},null,8,["modelValue"])]),_:1}),e(f,{label:"权限类型",prop:"type"},{default:s(()=>[e(M,{modelValue:i.type,"onUpdate:modelValue":t[10]||(t[10]=n=>i.type=n),placeholder:"请选择权限类型"},{default:s(()=>[e(C,{label:"菜单",value:"menu"}),e(C,{label:"按钮",value:"button"}),e(C,{label:"API",value:"api"})]),_:1},8,["modelValue"])]),_:1}),e(f,{label:"访问路径",prop:"path"},{default:s(()=>[e(w,{modelValue:i.path,"onUpdate:modelValue":t[11]||(t[11]=n=>i.path=n),placeholder:"请输入访问路径（菜单类型必填）"},null,8,["modelValue"])]),_:1}),e(f,{label:"父权限",prop:"parentId"},{default:s(()=>[e(M,{modelValue:i.parentId,"onUpdate:modelValue":t[12]||(t[12]=n=>i.parentId=n),placeholder:"请选择父权限"},{default:s(()=>[e(C,{value:"",label:"无父权限"}),($(!0),W(De,null,Ke(S.value,n=>($(),ee(C,{key:n.id,label:n.name,value:n.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(f,{label:"描述",prop:"description"},{default:s(()=>[e(w,{modelValue:i.description,"onUpdate:modelValue":t[13]||(t[13]=n=>i.description=n),type:"textarea",placeholder:"请输入权限描述",rows:"3"},null,8,["modelValue"])]),_:1}),e(f,{label:"排序",prop:"sort"},{default:s(()=>[e(ce,{modelValue:i.sort,"onUpdate:modelValue":t[14]||(t[14]=n=>i.sort=n),min:1,max:999,placeholder:"请输入排序值"},null,8,["modelValue"])]),_:1}),e(f,{label:"状态",prop:"status"},{default:s(()=>[e(D,{modelValue:i.status,"onUpdate:modelValue":t[15]||(t[15]=n=>i.status=n)},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}}),ht=Ge(it,[["__scopeId","data-v-abbcd1be"]]);export{ht as default};
