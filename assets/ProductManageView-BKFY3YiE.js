/* empty css                  *//* empty css                        *//* empty css                 *//* empty css                        *//* empty css                */import{d as ue,r as i,a as j,q as de,t as S,w as t,e as a,m as ce,l as pe,E as me,f as ge,g as fe,L as ve,c as p,F as P,G as U,h as _e,j as v,x as ye,b as w,M as we,N as be,v as I,O as B,P as he,y as ke,i as C,Q as Ce,R as O,S as Ve,T as Ee,U as xe,V as A,W as Se,n as u,X as ze,p as r,Y as Fe,_ as Pe}from"./index-D3HzW_Px.js";import{P as Ue}from"./PageLayout-C2MZ-4xL.js";import{a as Ie,b as Be,d as De,u as Me,c as Ne,e as Le}from"./api-DmWqOvHR.js";import"./mockData-BJpfVYbw.js";const Re={key:0,class:"image-preview"},Te={key:1,class:"image-count"},qe={key:1,class:"no-image"},$e={class:"action-buttons"},je={class:"pagination-container"},Oe={key:0,class:"preview-list"},Ae={class:"dialog-footer"},Ke=ue({__name:"ProductManageView",setup(Ge){const z=i([]),_=i({name:"",category:void 0}),n=i({page:1,pageSize:10,total:0}),D=i([]),K=i([]),b=i(!1),y=i(!1),h=i(!1),k=i(),m=i([]),s=j({id:0,name:"",price:0,stock:0,category:0,images:[]}),G=j({name:[{required:!0,message:"请输入商品名称",trigger:"blur"},{min:2,max:50,message:"商品名称长度在 2 到 50 个字符",trigger:"blur"}],price:[{required:!0,message:"请输入商品价格",trigger:"blur"},{type:"number",min:0,message:"商品价格必须大于等于0",trigger:"blur"}],stock:[{required:!0,message:"请输入商品库存",trigger:"blur"},{type:"number",min:0,message:"商品库存必须大于等于0",trigger:"blur"}],category:[{required:!0,message:"请选择商品分类",trigger:"change"}]}),g=async()=>{b.value=!0;try{const o={..._.value,page:n.value.page,pageSize:n.value.pageSize},e=await Be(o);D.value=e.list,n.value.total=e.total}finally{b.value=!1}},F=()=>{n.value.page=1,g(),u.success("搜索完成")},Q=()=>{_.value={name:"",category:void 0},n.value.page=1,g(),u.success("重置完成")},W=o=>{n.value.pageSize=o,g()},X=o=>{n.value.page=o,g()},Y=o=>{K.value=o},H=()=>{h.value=!1,M(),y.value=!0},J=o=>{h.value=!0,Object.assign(s,o),m.value=[],y.value=!0},Z=async o=>{try{await ze.confirm(`确定要删除商品「${o.name}」吗？此操作不可撤销。`,"删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning",customClass:"delete-confirm-message-box",confirmButtonClass:"delete-confirm-btn",distinguishCancelAndClose:!0,autofocus:!1}),await De(o.id),u.success("删除成功"),g()}catch(e){e!=="cancel"&&e!=="close"&&(u.error("删除失败："+(e.message||"未知错误")),console.error("删除商品失败:",e))}},M=()=>{k.value&&k.value.resetFields(),Object.assign(s,{id:0,name:"",price:0,stock:0,category:0,images:[]}),m.value=[]},ee=async o=>{try{const e=await Me(o.raw);s.images.push(e),m.value=[],u.success("图片上传成功")}catch(e){u.error("图片上传失败："+(e.message||"未知错误"))}},ae=o=>{const e=m.value.findIndex(V=>V.uid===o.uid);e!==-1&&m.value.splice(e,1)},le=o=>{s.images.splice(o,1),u.success("图片删除成功")},te=()=>{M()},oe=async()=>{if(k.value)try{if(await k.value.validate(),b.value=!0,h.value){const o={...s};await Ne(o),u.success("商品更新成功")}else{const o={name:s.name,price:s.price,stock:s.stock,category:s.category,images:s.images};await Le(o),u.success("商品新增成功")}y.value=!1,g()}catch(o){o.name!=="ValidationError"&&u.error("操作失败："+(o.message||"未知错误"))}finally{b.value=!1}};return de(async()=>{z.value=await Ie(),await g()}),(o,e)=>{const V=ge,d=me,N=Fe,L=ve,f=_e,R=ce,T=ye,c=be,q=he,E=ke,se=we,ne=Ve,$=Ee,re=xe,ie=Se;return r(),S(Ue,{title:"商品管理",actions:[{type:"primary",text:"新增商品",icon:C(A),onClick:H}]},{default:t(()=>[a(T,{shadow:"never",class:"search-form"},{default:t(()=>[a(R,{inline:!0,onSubmit:pe(F,["prevent"])},{default:t(()=>[a(d,{label:"商品名称"},{default:t(()=>[a(V,{modelValue:_.value.name,"onUpdate:modelValue":e[0]||(e[0]=l=>_.value.name=l),placeholder:"请输入商品名称",clearable:"",onKeyup:fe(F,["enter"]),style:{width:"240px"}},null,8,["modelValue"])]),_:1}),a(d,{label:"商品分类"},{default:t(()=>[a(L,{modelValue:_.value.category,"onUpdate:modelValue":e[1]||(e[1]=l=>_.value.category=l),placeholder:"请选择商品分类",clearable:"",style:{width:"180px"}},{default:t(()=>[(r(!0),p(U,null,P(z.value,l=>(r(),S(N,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(d,null,{default:t(()=>[a(f,{type:"primary",onClick:F},{default:t(()=>[...e[11]||(e[11]=[v("搜索",-1)])]),_:1}),a(f,{onClick:Q},{default:t(()=>[...e[12]||(e[12]=[v("重置",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),a(T,{shadow:"never",class:"table-container"},{default:t(()=>[a(se,{data:D.value,style:{width:"100%"},onSelectionChange:Y,border:""},{default:t(()=>[a(c,{type:"selection",width:"55"}),a(c,{prop:"id",label:"商品ID",width:"80",align:"center"}),a(c,{prop:"name",label:"商品名称","min-width":"200","show-overflow-tooltip":""}),a(c,{prop:"categoryName",label:"商品分类",width:"120",align:"center"}),a(c,{prop:"price",label:"价格",width:"100",align:"center"},{default:t(l=>[v(I(l.row.price.toFixed(2)),1)]),_:1}),a(c,{prop:"stock",label:"库存",width:"100",align:"center"}),a(c,{prop:"images",label:"商品图片",width:"200",align:"center"},{default:t(l=>[l.row.images.length>0?(r(),p("div",Re,[l.row.images[0]?(r(),S(q,{key:0,src:l.row.images[0],"preview-src-list":l.row.images,fit:"cover",class:"product-image"},{placeholder:t(()=>[...e[13]||(e[13]=[w("div",{class:"image-placeholder"},"无图片",-1)])]),_:1},8,["src","preview-src-list"])):B("",!0),l.row.images.length>1?(r(),p("span",Te,"+"+I(l.row.images.length-1),1)):B("",!0)])):(r(),p("span",qe,"无图片"))]),_:1}),a(c,{label:"操作",width:"180",fixed:"right",align:"center"},{default:t(l=>[w("div",$e,[a(f,{type:"primary",size:"small",onClick:x=>J(l.row),class:"mr-2"},{default:t(()=>[a(E,null,{default:t(()=>[a(C(Ce))]),_:1}),e[14]||(e[14]=v(" 编辑 ",-1))]),_:1},8,["onClick"]),a(f,{type:"danger",size:"small",onClick:x=>Z(l.row)},{default:t(()=>[a(E,null,{default:t(()=>[a(C(O))]),_:1}),e[15]||(e[15]=v(" 删除 ",-1))]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["data"]),w("div",je,[a(ne,{"current-page":n.value.page,"onUpdate:currentPage":e[2]||(e[2]=l=>n.value.page=l),"page-size":n.value.pageSize,"onUpdate:pageSize":e[3]||(e[3]=l=>n.value.pageSize=l),"page-sizes":[10,20,50,100],total:n.value.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:W,onCurrentChange:X},null,8,["current-page","page-size","total"])])]),_:1}),a(ie,{modelValue:y.value,"onUpdate:modelValue":e[10]||(e[10]=l=>y.value=l),title:h.value?"编辑商品":"新增商品",width:"800px",onClose:te},{footer:t(()=>[w("span",Ae,[a(f,{onClick:e[9]||(e[9]=l=>y.value=!1)},{default:t(()=>[...e[18]||(e[18]=[v("取消",-1)])]),_:1}),a(f,{type:"primary",onClick:oe,loading:b.value},{default:t(()=>[v(I(h.value?"更新":"保存"),1)]),_:1},8,["loading"])])]),default:t(()=>[a(R,{ref_key:"productFormRef",ref:k,model:s,rules:G,"label-width":"100px"},{default:t(()=>[a(d,{prop:"name",label:"商品名称"},{default:t(()=>[a(V,{modelValue:s.name,"onUpdate:modelValue":e[4]||(e[4]=l=>s.name=l),placeholder:"请输入商品名称"},null,8,["modelValue"])]),_:1}),a(d,{prop:"price",label:"商品价格"},{default:t(()=>[a($,{modelValue:s.price,"onUpdate:modelValue":e[5]||(e[5]=l=>s.price=l),min:0,step:.01,precision:2,placeholder:"请输入商品价格",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),a(d,{prop:"stock",label:"商品库存"},{default:t(()=>[a($,{modelValue:s.stock,"onUpdate:modelValue":e[6]||(e[6]=l=>s.stock=l),min:0,step:1,placeholder:"请输入商品库存",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),a(d,{prop:"category",label:"商品分类"},{default:t(()=>[a(L,{modelValue:s.category,"onUpdate:modelValue":e[7]||(e[7]=l=>s.category=l),placeholder:"请选择商品分类",style:{width:"100%"}},{default:t(()=>[(r(!0),p(U,null,P(z.value,l=>(r(),S(N,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(d,{label:"商品图片"},{default:t(()=>[a(re,{"file-list":m.value,"onUpdate:fileList":e[8]||(e[8]=l=>m.value=l),class:"image-uploader","auto-upload":!1,"on-change":ee,"on-remove":ae,"list-type":"picture-card",limit:5},{tip:t(()=>[...e[16]||(e[16]=[w("div",{class:"el-upload__tip"}," 请上传图片，最多5张 ",-1)])]),default:t(()=>[a(E,null,{default:t(()=>[a(C(A))]),_:1})]),_:1},8,["file-list"]),s.images.length>0?(r(),p("div",Oe,[(r(!0),p(U,null,P(s.images,(l,x)=>(r(),p("div",{class:"preview-item",key:x},[a(q,{src:l,"preview-src-list":s.images,fit:"cover"},{error:t(()=>[...e[17]||(e[17]=[w("div",{class:"image-placeholder"},"图片加载失败",-1)])]),_:1},8,["src","preview-src-list"]),a(f,{type:"danger",size:"small",class:"delete-image-btn",onClick:Qe=>le(x)},{default:t(()=>[a(E,null,{default:t(()=>[a(C(O))]),_:1})]),_:1},8,["onClick"])]))),128))])):B("",!0)]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])]),_:1},8,["actions"])}}}),ta=Pe(Ke,[["__scopeId","data-v-b0b0ffd6"]]);export{ta as default};
