import{E as le}from"./el-button-Vc6VEKII.js";import{E as oe}from"./el-overlay-BzxwWa47.js";import{E as re}from"./EditDialog-BfRFKqG6.js";import{E as ie}from"./el-date-picker-panel-BabABFbM.js";import{b as se,E as de,a as ne}from"./el-input-CFf0CTHR.js";import{b as ue,h as pe,c as me,e as ve,f as ce}from"./el-table-column-DnVx5bAE.js";import{E as fe}from"./el-input-number-BnT4jGWw.js";import{E as ge}from"./el-tag-H94PFL3m.js";import{E as ye}from"./el-card-CgDv5Emn.js";import{d as we,p as w,C as be,g as h,w as l,t as a,s,y as _e,v as $,x as d,F as m,aG as Q,E as Ve,k as V,b6 as he,aD as Te,an as Ie,at as ke,f as q,h as z,aE as De,as as Ee,b7 as Ce,z as p,b8 as Ne,o as b,B as Qe}from"./index-ClAeb_nj.js";import{P as xe}from"./PageLayout-2dU49uLu.js";import{D as qe,E as ze,F as Se,G as H}from"./api-D03_kbYf.js";import{E as Ue}from"./index-Az46Y9ah.js";import"./index-4rY4zpWs.js";import"./mockData-C7SYYOmC.js";const Ye={class:"table-action-buttons"},Me={class:"pagination-container"},Be={class:"task-detail-content"},$e={class:"detail-row"},He={class:"detail-row"},Fe={class:"detail-row"},Ae={class:"detail-row"},Pe={class:"detail-row"},Ke={class:"detail-row"},Le={class:"detail-row"},Ge={key:0,class:"detail-row"},Oe={key:1,class:"detail-row"},Re={key:2,class:"detail-row"},je={class:"detail-row"},Je={class:"detail-row"},We={class:"dialog-footer"},Xe=we({__name:"DispatchCenterView",setup(Ze){const v=w({taskNo:"",orderId:void 0,status:void 0,priority:void 0}),f=w({page:1,pageSize:10,total:100}),S=w([]),T=w(!1),o=w({id:0,taskNo:"",orderId:"",warehouseId:"",warehouseName:"",status:"pending",priority:"medium",requiredQuantity:1,dispatchedQuantity:0,operator:"",startTime:"",endTime:""}),F=w(!1),I=w(!1),i=w(null),k=async()=>{f.value.page=1,await y()},y=async()=>{const r={taskNo:v.value.taskNo,orderId:v.value.orderId,status:v.value.status,priority:v.value.priority,page:f.value.page,pageSize:f.value.pageSize};try{const e=await qe(r);S.value=e.list,f.value.total=e.total}catch(e){p.error(`获取调度任务失败: ${e.message}`)}},A=async()=>{v.value={taskNo:"",orderId:void 0,status:void 0,priority:void 0},f.value.page=1,await y()},P=async r=>{f.value.pageSize=r,await y()},K=async r=>{f.value.page=r,await y()},L=async()=>{const r={orderId:Math.floor(Math.random()*1e4),warehouseId:1,priority:"medium",requiredQuantity:10,items:[{productName:"测试商品",sku:"TEST"+Date.now(),quantity:10,location:"A-1-1"}]};try{await ze(r),p.success("调度任务创建成功"),await y()}catch(e){p.error(`创建调度任务失败: ${e.message}`)}},G=()=>{p.info("查看调度规则功能开发中")},O=()=>{p.info("批量调度功能开发中")},R=r=>{i.value=r,I.value=!0},j=r=>{o.value={id:r.id,taskNo:r.taskNo,orderId:r.orderId.toString(),warehouseId:r.warehouseId.toString(),warehouseName:r.warehouseName,status:r.status,priority:r.priority,requiredQuantity:r.requiredQuantity,dispatchedQuantity:r.dispatchedQuantity,operator:r.operator||"",startTime:r.startTime||"",endTime:r.endTime||""},T.value=!0},J=async()=>{try{const r=["orderId","warehouseId","priority","requiredQuantity"];for(const c of r)if(!o.value[c]){p.warning(`请填写${c==="orderId"?"订单ID":c==="warehouseId"?"仓库":c==="priority"?"优先级":"需求数量"}`);return}if(parseInt(o.value.orderId)<=0){p.warning("订单ID必须为正整数");return}if(parseInt(o.value.warehouseId)<=0){p.warning("请选择有效仓库");return}if(o.value.requiredQuantity<=0){p.warning("需求数量必须大于0");return}const e={id:o.value.id,orderId:parseInt(o.value.orderId),warehouseId:parseInt(o.value.warehouseId),status:o.value.status,priority:o.value.priority,requiredQuantity:o.value.requiredQuantity,dispatchedQuantity:o.value.dispatchedQuantity,operator:o.value.operator,startTime:o.value.startTime||void 0,endTime:o.value.endTime||void 0};e.startTime&&!e.startTime.match(/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}/)&&delete e.startTime,e.endTime&&!e.endTime.match(/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}/)&&delete e.endTime,await H(e),p.success("调度任务更新成功"),T.value=!1,await y()}catch(r){p.error(`更新调度任务失败: ${r.message}`),console.error("更新调度任务失败:",r)}},W=async r=>{try{await Ue.confirm("确定要取消该调度任务吗？此操作不可撤销。","取消任务确认",{confirmButtonText:"确定取消",cancelButtonText:"保留任务",type:"warning",customClass:"cancel-task-message-box",confirmButtonClass:"cancel-confirm-btn",distinguishCancelAndClose:!0,autofocus:!1}),await Se(r.id),p.success("任务已取消"),await y()}catch(e){e!=="cancel"&&e!=="close"&&(p.error(`取消调度任务失败: ${e.message}`),console.error("取消调度任务失败:",e))}},X=async r=>{const e={id:r.id,status:"completed",dispatchedQuantity:r.requiredQuantity||0,endTime:new Date().toISOString()};try{await H(e),p.success("调度任务执行成功"),await y()}catch(c){p.error(`执行调度任务失败: ${c.message}`)}};return be(async()=>{await y()}),(r,e)=>{const c=ne,n=de,u=pe,D=ue,_=le,U=se,Y=ye,g=ve,E=ge,C=Ve,Z=me,ee=ce,M=fe,B=ie,ae=re,te=oe,N=Ne("permission");return b(),h(xe,{title:"调度中心",actions:[{type:"primary",text:"创建调度任务",icon:V(De),onClick:L},{type:"info",text:"调度规则",icon:V(Ee),onClick:G},{type:"success",text:"批量调度",icon:V(Ce),onClick:O}]},{default:l(()=>[a(Y,{shadow:"never",class:"search-form"},{default:l(()=>[a(U,{inline:!0,onSubmit:_e(k,["prevent"])},{default:l(()=>[a(n,{label:"任务编号"},{default:l(()=>[a(c,{modelValue:v.value.taskNo,"onUpdate:modelValue":e[0]||(e[0]=t=>v.value.taskNo=t),placeholder:"请输入任务编号",clearable:"",onKeyup:$(k,["enter"])},null,8,["modelValue"])]),_:1}),a(n,{label:"订单ID"},{default:l(()=>[a(c,{modelValue:v.value.orderId,"onUpdate:modelValue":e[1]||(e[1]=t=>v.value.orderId=t),type:"number",placeholder:"请输入订单ID",clearable:"",onKeyup:$(k,["enter"])},null,8,["modelValue"])]),_:1}),a(n,{label:"任务状态"},{default:l(()=>[a(D,{modelValue:v.value.status,"onUpdate:modelValue":e[2]||(e[2]=t=>v.value.status=t),placeholder:"请选择任务状态",clearable:""},{default:l(()=>[a(u,{label:"待调度",value:"pending"}),a(u,{label:"调度中",value:"processing"}),a(u,{label:"已完成",value:"completed"}),a(u,{label:"失败",value:"failed"})]),_:1},8,["modelValue"])]),_:1}),a(n,{label:"优先级"},{default:l(()=>[a(D,{modelValue:v.value.priority,"onUpdate:modelValue":e[3]||(e[3]=t=>v.value.priority=t),placeholder:"请选择优先级",clearable:""},{default:l(()=>[a(u,{label:"低",value:"low"}),a(u,{label:"中",value:"medium"}),a(u,{label:"高",value:"high"})]),_:1},8,["modelValue"])]),_:1}),a(n,null,{default:l(()=>[a(_,{type:"primary",onClick:k},{default:l(()=>[...e[19]||(e[19]=[d("搜索",-1)])]),_:1}),a(_,{onClick:A},{default:l(()=>[...e[20]||(e[20]=[d("重置",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),a(Y,{shadow:"never",class:"table-container"},{default:l(()=>[a(Z,{data:S.value,stripe:"",style:{width:"100%"}},{default:l(()=>[a(g,{prop:"id",label:"任务ID",width:"120",align:"center"}),a(g,{prop:"taskNo",label:"任务编号",width:"180"}),a(g,{prop:"orderId",label:"订单ID",width:"120",align:"center"}),a(g,{prop:"warehouseName",label:"仓库",width:"120",align:"center"}),a(g,{prop:"requiredQuantity",label:"需求数量",width:"120",align:"center"}),a(g,{prop:"dispatchedQuantity",label:"已调度数量",width:"120",align:"center"}),a(g,{prop:"priority",label:"优先级",width:"100",align:"center"},{default:l(t=>[a(E,{type:t.row.priority==="high"?"danger":t.row.priority==="medium"?"warning":"success"},{default:l(()=>[d(m(t.row.priority==="high"?"高":t.row.priority==="medium"?"中":"低"),1)]),_:2},1032,["type"])]),_:1}),a(g,{prop:"status",label:"状态",width:"100",align:"center"},{default:l(t=>[a(E,{type:t.row.status==="pending"?"info":t.row.status==="processing"?"warning":t.row.status==="completed"?"success":"danger"},{default:l(()=>[d(m(t.row.status==="pending"?"待调度":t.row.status==="processing"?"调度中":t.row.status==="completed"?"已完成":"失败"),1)]),_:2},1032,["type"])]),_:1}),a(g,{prop:"operator",label:"操作人",width:"120"}),a(g,{prop:"createdAt",label:"创建时间",width:"180"}),a(g,{prop:"endTime",label:"完成时间",width:"180"}),a(g,{label:"操作",width:"300",fixed:"right",align:"center"},{default:l(t=>[s("div",Ye,[Q((b(),h(_,{type:"primary",size:"small",onClick:x=>R(t.row)},{default:l(()=>[a(C,null,{default:l(()=>[a(V(he))]),_:1}),e[21]||(e[21]=d(" 查看 ",-1))]),_:1},8,["onClick"])),[[N,"dispatch_view"]]),Q((b(),h(_,{type:"warning",size:"small",onClick:x=>j(t.row)},{default:l(()=>[a(C,null,{default:l(()=>[a(V(Te))]),_:1}),e[22]||(e[22]=d(" 编辑 ",-1))]),_:1},8,["onClick"])),[[N,"dispatch_edit"]]),Q((b(),h(_,{type:"success",size:"small",onClick:x=>X(t.row),disabled:t.row.status!=="pending"},{default:l(()=>[a(C,null,{default:l(()=>[a(V(Ie))]),_:1}),e[23]||(e[23]=d(" 执行 ",-1))]),_:1},8,["onClick","disabled"])),[[N,"dispatch_execute"]]),Q((b(),h(_,{type:"danger",size:"small",onClick:x=>W(t.row),disabled:t.row.status!=="pending"},{default:l(()=>[a(C,null,{default:l(()=>[a(V(ke))]),_:1}),e[24]||(e[24]=d(" 取消 ",-1))]),_:1},8,["onClick","disabled"])),[[N,"dispatch_cancel"]])])]),_:1})]),_:1},8,["data"])]),_:1}),s("div",Me,[a(ee,{"current-page":f.value.page,"onUpdate:currentPage":e[4]||(e[4]=t=>f.value.page=t),"page-size":f.value.pageSize,"onUpdate:pageSize":e[5]||(e[5]=t=>f.value.pageSize=t),"page-sizes":[10,20,50,100],total:f.value.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:P,onCurrentChange:K},null,8,["current-page","page-size","total"])]),a(ae,{modelValue:T.value,"onUpdate:modelValue":e[16]||(e[16]=t=>T.value=t),title:"编辑调度任务","is-loading":F.value,onConfirm:J},{default:l(()=>[a(U,{model:o.value,"label-width":"120px"},{default:l(()=>[a(n,{label:"任务编号",prop:"taskNo"},{default:l(()=>[a(c,{modelValue:o.value.taskNo,"onUpdate:modelValue":e[6]||(e[6]=t=>o.value.taskNo=t),disabled:""},null,8,["modelValue"])]),_:1}),a(n,{label:"订单ID",prop:"orderId"},{default:l(()=>[a(c,{modelValue:o.value.orderId,"onUpdate:modelValue":e[7]||(e[7]=t=>o.value.orderId=t),disabled:""},null,8,["modelValue"])]),_:1}),a(n,{label:"仓库",prop:"warehouseName"},{default:l(()=>[a(c,{modelValue:o.value.warehouseName,"onUpdate:modelValue":e[8]||(e[8]=t=>o.value.warehouseName=t),disabled:""},null,8,["modelValue"])]),_:1}),a(n,{label:"优先级",prop:"priority",required:""},{default:l(()=>[a(D,{modelValue:o.value.priority,"onUpdate:modelValue":e[9]||(e[9]=t=>o.value.priority=t),placeholder:"请选择优先级",clearable:""},{default:l(()=>[a(u,{label:"低",value:"low"}),a(u,{label:"中",value:"medium"}),a(u,{label:"高",value:"high"})]),_:1},8,["modelValue"])]),_:1}),a(n,{label:"需求数量",prop:"requiredQuantity",required:""},{default:l(()=>[a(M,{modelValue:o.value.requiredQuantity,"onUpdate:modelValue":e[10]||(e[10]=t=>o.value.requiredQuantity=t),min:1,max:99999},null,8,["modelValue"])]),_:1}),a(n,{label:"已调度数量",prop:"dispatchedQuantity"},{default:l(()=>[a(M,{modelValue:o.value.dispatchedQuantity,"onUpdate:modelValue":e[11]||(e[11]=t=>o.value.dispatchedQuantity=t),min:0,max:o.value.requiredQuantity},null,8,["modelValue","max"])]),_:1}),a(n,{label:"状态",prop:"status",required:""},{default:l(()=>[a(D,{modelValue:o.value.status,"onUpdate:modelValue":e[12]||(e[12]=t=>o.value.status=t),placeholder:"请选择状态",clearable:""},{default:l(()=>[a(u,{label:"待调度",value:"pending"}),a(u,{label:"调度中",value:"processing"}),a(u,{label:"已完成",value:"completed"}),a(u,{label:"失败",value:"failed"}),a(u,{label:"已取消",value:"cancelled"})]),_:1},8,["modelValue"])]),_:1}),a(n,{label:"操作人",prop:"operator"},{default:l(()=>[a(c,{modelValue:o.value.operator,"onUpdate:modelValue":e[13]||(e[13]=t=>o.value.operator=t),placeholder:"请输入操作人",clearable:""},null,8,["modelValue"])]),_:1}),a(n,{label:"开始时间",prop:"startTime"},{default:l(()=>[a(B,{modelValue:o.value.startTime,"onUpdate:modelValue":e[14]||(e[14]=t=>o.value.startTime=t),type:"datetime",placeholder:"请选择开始时间",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DDTHH:mm:ss",clearable:""},null,8,["modelValue"])]),_:1}),a(n,{label:"结束时间",prop:"endTime"},{default:l(()=>[a(B,{modelValue:o.value.endTime,"onUpdate:modelValue":e[15]||(e[15]=t=>o.value.endTime=t),type:"datetime",placeholder:"请选择结束时间",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DDTHH:mm:ss",clearable:""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","is-loading"]),a(te,{modelValue:I.value,"onUpdate:modelValue":e[18]||(e[18]=t=>I.value=t),title:"调度任务详情",width:"600px","close-on-click-modal":!0,"append-to-body":!0},{footer:l(()=>[s("div",We,[a(_,{onClick:e[17]||(e[17]=t=>I.value=!1)},{default:l(()=>[...e[37]||(e[37]=[d("关闭",-1)])]),_:1})])]),default:l(()=>[s("div",Be,[s("div",$e,[e[25]||(e[25]=s("strong",null,"任务编号：",-1)),d(m(i.value?.taskNo),1)]),s("div",He,[e[26]||(e[26]=s("strong",null,"订单ID：",-1)),d(m(i.value?.orderId),1)]),s("div",Fe,[e[27]||(e[27]=s("strong",null,"仓库：",-1)),d(m(i.value?.warehouseName),1)]),s("div",Ae,[e[28]||(e[28]=s("strong",null,"优先级：",-1)),a(E,{type:i.value?.priority==="high"?"danger":i.value?.priority==="medium"?"warning":"success"},{default:l(()=>[d(m(i.value?.priority==="high"?"高":i.value?.priority==="medium"?"中":"低"),1)]),_:1},8,["type"])]),s("div",Pe,[e[29]||(e[29]=s("strong",null,"需求数量：",-1)),d(m(i.value?.requiredQuantity),1)]),s("div",Ke,[e[30]||(e[30]=s("strong",null,"已调度数量：",-1)),d(m(i.value?.dispatchedQuantity),1)]),s("div",Le,[e[31]||(e[31]=s("strong",null,"状态：",-1)),a(E,{type:i.value?.status==="completed"?"success":i.value?.status==="processing"?"warning":i.value?.status==="failed"?"danger":"info"},{default:l(()=>[d(m(i.value?.status==="pending"?"待调度":i.value?.status==="processing"?"调度中":i.value?.status==="completed"?"已完成":i.value?.status==="failed"?"失败":"已取消"),1)]),_:1},8,["type"])]),i.value?.operator?(b(),q("div",Ge,[e[32]||(e[32]=s("strong",null,"操作人：",-1)),d(m(i.value.operator),1)])):z("",!0),i.value?.startTime?(b(),q("div",Oe,[e[33]||(e[33]=s("strong",null,"开始时间：",-1)),d(m(i.value.startTime),1)])):z("",!0),i.value?.endTime?(b(),q("div",Re,[e[34]||(e[34]=s("strong",null,"完成时间：",-1)),d(m(i.value.endTime),1)])):z("",!0),s("div",je,[e[35]||(e[35]=s("strong",null,"创建时间：",-1)),d(m(i.value?.createdAt),1)]),s("div",Je,[e[36]||(e[36]=s("strong",null,"更新时间：",-1)),d(m(i.value?.updatedAt),1)])])]),_:1},8,["modelValue"])]),_:1},8,["actions"])}}}),fa=Qe(Xe,[["__scopeId","data-v-19f20594"]]);export{fa as default};
