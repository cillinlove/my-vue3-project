/* empty css                  *//* empty css                        *//* empty css                             *//* empty css                 *//* empty css                        *//* empty css                */import{d as X,r as d,a as J,q as Z,t as ee,w as n,e as a,b as x,m as ae,l as te,E as le,f as ne,g as oe,L as se,Y as ie,h as ue,j as i,x as re,M as de,N as me,I as pe,v as R,y as ce,i as V,Q as ge,R as fe,S as _e,c as k,T as ve,a1 as ye,ac as we,ad as be,ae as Ve,W as Ce,V as he,n as u,X as Ee,p as C,_ as xe}from"./index-D3HzW_Px.js";import{P as Re}from"./PageLayout-C2MZ-4xL.js";import{A as ke,B as ze,C as Se,D as Te}from"./api-DmWqOvHR.js";import"./mockData-BJpfVYbw.js";const De={class:"action-buttons"},Pe={class:"pagination-container"},Ue={key:0,class:"form-tip"},Be={key:1,class:"form-tip"},Me={key:2,class:"form-tip"},Ye={class:"dialog-footer"},Ie=X({__name:"PromotionCenterView",setup(qe){const m=async()=>{try{const o={page:s.value.page,pageSize:s.value.pageSize,name:p.value.name,status:p.value.status},e=await ke(o);z.value=e.list,s.value.total=e.total}catch(o){u.error("获取促销活动列表失败："+(o.message||"未知错误"))}},p=d({name:"",status:void 0}),s=d({page:1,pageSize:10,total:100}),z=d([]),g=d(!1),f=d(!1),y=d(!1),w=d(),b=d(null),t=J({name:"",type:"discount",description:"",discountValue:0,timeRange:[],status:"active"}),M={name:[{required:!0,message:"请输入活动名称",trigger:"blur"},{min:2,max:50,message:"活动名称长度在 2-50 个字符之间",trigger:"blur"}],type:[{required:!0,message:"请选择活动类型",trigger:"change"}],description:[{required:!0,message:"请输入活动描述",trigger:"blur"}],discountValue:[{required:!0,message:"请输入优惠数值",trigger:"blur"},{type:"number",min:0,max:100,message:"优惠数值必须在 0-100 之间",trigger:"blur"}],timeRange:[{required:!0,message:"请选择活动时间",trigger:"change",type:"array"}],status:[{required:!0,message:"请选择活动状态",trigger:"change"}]},Y=()=>{t.name="",t.type="discount",t.description="",t.discountValue=0,t.timeRange=[],t.status="active",b.value=null,w.value&&w.value.resetFields()},I=()=>{f.value=!1,Y(),g.value=!0},q=async o=>{f.value=!0,b.value=o.id,t.name=o.name,t.type=o.type,t.description=o.description,t.discountValue=o.discountValue,t.timeRange=[o.startTime,o.endTime],t.status=o.status==="expired"?"inactive":o.status,g.value=!0},F=async()=>{w.value&&await w.value.validate(async o=>{if(o){y.value=!0;try{if(f.value&&b.value!==null){if(!t.timeRange[0]||!t.timeRange[1]){u.error("请选择完整的时间范围"),y.value=!1;return}const e={id:b.value,name:t.name,type:t.type,description:t.description,discountValue:t.discountValue,startTime:t.timeRange[0],endTime:t.timeRange[1],status:t.status};await ze(e),u.success("修改促销活动成功")}else{if(!t.timeRange[0]||!t.timeRange[1]){u.error("请选择完整的时间范围"),y.value=!1;return}const e={name:t.name,type:t.type,description:t.description,discountValue:t.discountValue,startTime:t.timeRange[0],endTime:t.timeRange[1]};await Se(e),u.success("创建促销活动成功")}g.value=!1,await m()}catch(e){u.error(f.value?"修改失败：":"创建失败："+(e.message||"未知错误"))}finally{y.value=!1}}})},h=async()=>{s.value.page=1,await m(),u.success("搜索完成")},N=async()=>{p.value={name:"",status:void 0},s.value.page=1,await m(),u.success("重置完成")},H=async o=>{s.value.pageSize=o,await m()},L=async o=>{s.value.page=o,await m()},$=async o=>{try{await Ee.confirm(`确定要删除促销活动「${o.name}」吗？此操作不可撤销。`,"删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning",customClass:"delete-confirm-message-box",confirmButtonClass:"delete-confirm-btn",distinguishCancelAndClose:!0,autofocus:!1}),await Te(o.id),await m(),u.success("删除成功")}catch(e){e!=="cancel"&&e!=="close"&&u.error("删除失败："+(e.message||"未知错误"))}};return Z(async()=>{await m()}),(o,e)=>{const E=ne,r=le,_=ie,S=se,v=ue,T=ae,D=re,c=me,P=pe,U=ce,A=de,j=_e,K=ve,G=ye,B=Ve,O=be,Q=Ce;return C(),ee(Re,{title:"促销中心",actions:[{type:"primary",text:"新增促销活动",icon:V(he),onClick:I}]},{default:n(()=>[a(D,{shadow:"never",class:"search-form"},{default:n(()=>[a(T,{inline:!0,onSubmit:te(h,["prevent"])},{default:n(()=>[a(r,{label:"活动名称"},{default:n(()=>[a(E,{modelValue:p.value.name,"onUpdate:modelValue":e[0]||(e[0]=l=>p.value.name=l),placeholder:"请输入活动名称",clearable:"",onKeyup:oe(h,["enter"])},null,8,["modelValue"])]),_:1}),a(r,{label:"活动状态"},{default:n(()=>[a(S,{modelValue:p.value.status,"onUpdate:modelValue":e[1]||(e[1]=l=>p.value.status=l),placeholder:"请选择活动状态",clearable:""},{default:n(()=>[a(_,{label:"未开始",value:"pending"}),a(_,{label:"进行中",value:"active"}),a(_,{label:"已结束",value:"ended"})]),_:1},8,["modelValue"])]),_:1}),a(r,null,{default:n(()=>[a(v,{type:"primary",onClick:h},{default:n(()=>[...e[12]||(e[12]=[i("搜索",-1)])]),_:1}),a(v,{onClick:N},{default:n(()=>[...e[13]||(e[13]=[i("重置",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),a(D,{shadow:"never",class:"table-container"},{default:n(()=>[a(A,{data:z.value,border:"",style:{width:"100%"}},{default:n(()=>[a(c,{prop:"id",label:"活动ID",width:"80",align:"center"}),a(c,{prop:"name",label:"活动名称","min-width":"200"}),a(c,{prop:"type",label:"活动类型",width:"120",align:"center"},{default:n(l=>[a(P,{type:l.row.type==="discount"?"primary":l.row.type==="coupon"?"success":"warning"},{default:n(()=>[i(R(l.row.type==="discount"?"折扣":l.row.type==="coupon"?"优惠券":"满减"),1)]),_:2},1032,["type"])]),_:1}),a(c,{prop:"startTime",label:"开始时间",width:"180"}),a(c,{prop:"endTime",label:"结束时间",width:"180"}),a(c,{prop:"status",label:"状态",width:"100",align:"center"},{default:n(l=>[a(P,{type:l.row.status==="pending"?"warning":l.row.status==="active"?"success":"info"},{default:n(()=>[i(R(l.row.status==="pending"?"未开始":l.row.status==="active"?"进行中":"已结束"),1)]),_:2},1032,["type"])]),_:1}),a(c,{label:"操作",width:"200",fixed:"right",align:"center"},{default:n(l=>[x("div",De,[a(v,{type:"primary",size:"small",onClick:W=>q(l.row)},{default:n(()=>[a(U,null,{default:n(()=>[a(V(ge))]),_:1}),e[14]||(e[14]=i(" 编辑 ",-1))]),_:1},8,["onClick"]),a(v,{type:"danger",size:"small",onClick:W=>$(l.row)},{default:n(()=>[a(U,null,{default:n(()=>[a(V(fe))]),_:1}),e[15]||(e[15]=i(" 删除 ",-1))]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["data"])]),_:1}),x("div",Pe,[a(j,{"current-page":s.value.page,"onUpdate:currentPage":e[2]||(e[2]=l=>s.value.page=l),"page-size":s.value.pageSize,"onUpdate:pageSize":e[3]||(e[3]=l=>s.value.pageSize=l),"page-sizes":[10,20,50,100],total:s.value.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:H,onCurrentChange:L},null,8,["current-page","page-size","total"])]),a(Q,{modelValue:g.value,"onUpdate:modelValue":e[11]||(e[11]=l=>g.value=l),title:f.value?"编辑促销活动":"新增促销活动",width:"600px","destroy-on-close":"","close-on-click-modal":!1},{footer:n(()=>[x("span",Ye,[a(v,{onClick:e[10]||(e[10]=l=>g.value=!1)},{default:n(()=>[...e[18]||(e[18]=[i("取消",-1)])]),_:1}),a(v,{type:"primary",loading:y.value,onClick:F},{default:n(()=>[i(R(f.value?"保存修改":"创建活动"),1)]),_:1},8,["loading"])])]),default:n(()=>[a(T,{ref_key:"formRef",ref:w,model:t,rules:M,"label-width":"100px",class:"promotion-form"},{default:n(()=>[a(r,{label:"活动名称",prop:"name"},{default:n(()=>[a(E,{modelValue:t.name,"onUpdate:modelValue":e[4]||(e[4]=l=>t.name=l),placeholder:"请输入活动名称",maxlength:"50","show-word-limit":""},null,8,["modelValue"])]),_:1}),a(r,{label:"活动类型",prop:"type"},{default:n(()=>[a(S,{modelValue:t.type,"onUpdate:modelValue":e[5]||(e[5]=l=>t.type=l),placeholder:"请选择活动类型",style:{width:"100%"}},{default:n(()=>[a(_,{label:"折扣",value:"discount"}),a(_,{label:"优惠券",value:"coupon"}),a(_,{label:"满减",value:"rebate"})]),_:1},8,["modelValue"])]),_:1}),a(r,{label:"活动描述",prop:"description"},{default:n(()=>[a(E,{modelValue:t.description,"onUpdate:modelValue":e[6]||(e[6]=l=>t.description=l),type:"textarea",placeholder:"请输入活动描述",rows:3,maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),_:1}),a(r,{label:"优惠数值",prop:"discountValue"},{default:n(()=>[a(K,{modelValue:t.discountValue,"onUpdate:modelValue":e[7]||(e[7]=l=>t.discountValue=l),min:0,max:100,precision:2,step:.01,style:{width:"100%"}},null,8,["modelValue"]),t.type==="discount"?(C(),k("span",Ue,"% (折扣百分比)")):t.type==="coupon"?(C(),k("span",Be,"元 (优惠券金额)")):(C(),k("span",Me,"元 (满减金额)"))]),_:1}),a(r,{label:"活动时间",prop:"timeRange"},{default:n(()=>[a(G,{modelValue:t.timeRange,"onUpdate:modelValue":e[8]||(e[8]=l=>t.timeRange=l),type:"datetimerange",locale:V(we),"range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间",format:"YYYY-MM-DD HH:mm:ss","value-format":"YYYY-MM-DD HH:mm:ss",style:{width:"100%"}},null,8,["modelValue","locale"])]),_:1}),a(r,{label:"活动状态",prop:"status"},{default:n(()=>[a(O,{modelValue:t.status,"onUpdate:modelValue":e[9]||(e[9]=l=>t.status=l)},{default:n(()=>[a(B,{value:"active"},{default:n(()=>[...e[16]||(e[16]=[i("启用",-1)])]),_:1}),a(B,{value:"inactive"},{default:n(()=>[...e[17]||(e[17]=[i("禁用",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])]),_:1},8,["actions"])}}}),Qe=xe(Ie,[["__scopeId","data-v-9ce28175"]]);export{Qe as default};
