/* empty css                  *//* empty css                        *//* empty css               *//* empty css                 *//* empty css                */import{d as ce,r as C,a as I,q as ge,t as h,w as t,e as l,m as fe,l as ve,E as be,f as _e,g as P,y as ye,c as g,z as k,i as f,F as x,h as we,j as i,x as he,C as M,b as F,A as Ve,B as Ce,Q as ke,v,G as xe,H as Se,R as Ee,I as A,J as ze,S as Te,T as Ue,N as Be,M as De,n as c,O as K,p as d,P as Fe,_ as Le}from"./index-BSOYK04B.js";import{P as Oe}from"./PageLayout-53LlZDnx.js";import{f as $e,h as Ie,i as Pe,t as je,j as Ne,k as Re}from"./api-DmWqOvHR.js";import"./mockData-BJpfVYbw.js";const L=[{value:"regular",label:"普通客户",color:"#909399"},{value:"silver",label:"银牌客户",color:"#C0C4CC"},{value:"gold",label:"金牌客户",color:"#E6A23C"},{value:"platinum",label:"铂金客户",color:"#409EFF"}],O=[{value:"active",label:"正常",type:"success"},{value:"inactive",label:"不活跃",type:"warning"},{value:"blocked",label:"已禁用",type:"danger"}],qe={key:0,class:"tag-list"},Me={key:1,class:"text-gray-400"},Ae={class:"action-buttons"},Ke={key:0,class:"batch-actions"},Ge={class:"selected-count"},He={class:"pagination-container"},Je={class:"dialog-footer"},Qe=ce({__name:"CustomerCenterView",setup(We){const j=C([]),b=C([]),V=C(!1),S=C(!1),$=C(!1),U=C(),u=I({name:"",email:"",phone:"",level:void 0,status:void 0,page:1,pageSize:10}),m=I({page:1,pageSize:10,total:0}),n=I({id:void 0,name:"",email:"",phone:"",company:"",address:"",level:"regular",status:"active",tags:[],notes:""}),G={name:[{required:!0,message:"请输入客户名称",trigger:"blur"},{min:2,max:50,message:"客户名称长度在 2 到 50 个字符之间",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱地址",trigger:"blur"},{type:"email",message:"请输入有效的邮箱地址",trigger:"blur"}],phone:[{required:!0,message:"请输入手机号",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入有效的手机号",trigger:"blur"}],address:[{required:!0,message:"请输入地址",trigger:"blur"}]},H=["VIP","老客户","新客户","高价值","潜力客户","投诉过的","企业客户","个人客户"],y=async()=>{try{const o={...u,page:m.page,pageSize:m.pageSize},a=await $e(o);j.value=a.list,m.total=a.total,m.page=a.page,m.pageSize=a.pageSize}catch(o){c.error("获取客户列表失败"),console.error(o)}},w=()=>{m.page=1,y()},J=()=>{u.name="",u.email="",u.phone="",u.level=void 0,u.status=void 0,w()},Q=o=>{b.value=o},W=()=>{y()},X=()=>{S.value=!1,te(),V.value=!0},Y=o=>{S.value=!0,Object.assign(n,{id:o.id,name:o.name,email:o.email,phone:o.phone,company:o.company||"",address:o.address,level:o.level,status:o.status,tags:[...o.tags],notes:o.notes||""}),V.value=!0},Z=async o=>{try{await K.confirm(`确定要删除客户 "${o.name}" 吗？此操作不可恢复。`,"删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning"}),await Ie(o.id),c.success("删除成功"),y()}catch(a){a!=="cancel"&&(c.error("删除失败"),console.error(a))}},ee=async()=>{if(b.value.length!==0)try{const o=b.value.map(s=>s.name).join("、");await K.confirm(`确定要删除选中的 ${b.value.length} 个客户吗？${o} 将会被删除，此操作不可恢复。`,"批量删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning"});const a=b.value.map(s=>s.id);await Pe(a),c.success("批量删除成功"),b.value=[],y()}catch(o){o!=="cancel"&&(c.error("批量删除失败"),console.error(o))}},le=async o=>{const a=o.status==="active"?"blocked":"active",s=o.status==="active"?"禁用":"启用";try{await je(o.id,a),c.success(`${s}成功`),y()}catch(r){c.error(`${s}失败`),console.error(r)}},ae=async()=>{if(U.value)try{if(await U.value.validate(),$.value=!0,S.value&&n.id){const o={id:n.id,name:n.name,email:n.email,phone:n.phone,company:n.company,address:n.address,level:n.level,status:n.status,tags:n.tags,notes:n.notes};await Ne(o),c.success("更新成功")}else{const o={name:n.name,email:n.email,phone:n.phone,company:n.company,address:n.address,level:n.level,tags:n.tags,notes:n.notes};await Re(o),c.success("创建成功")}V.value=!1,y()}catch(o){o!=="cancel"&&(c.error("操作失败"),console.error(o))}finally{$.value=!1}},te=()=>{Object.assign(n,{id:void 0,name:"",email:"",phone:"",company:"",address:"",level:"regular",status:"active",tags:[],notes:""}),U.value?.clearValidate()},oe=o=>{const a=L.find(s=>s.value===o);return a?.color==="#409EFF"?"primary":a?.color==="#E6A23C"?"warning":a?.color==="#C0C4CC"?"info":""},ne=o=>L.find(s=>s.value===o)?.label||o,se=o=>O.find(s=>s.value===o)?.type||"",re=o=>O.find(s=>s.value===o)?.label||o,ue=o=>new Date(o).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"});return ge(()=>{y()}),(o,a)=>{const s=_e,r=be,E=Fe,z=ye,_=we,N=fe,R=he,p=Ce,B=ke,D=xe,de=Ve,ie=ze,q=Ue,pe=Te,me=Be;return d(),h(Oe,{title:"客户中心",actions:[{type:"primary",text:"新增客户",icon:f(De),onClick:X}]},{default:t(()=>[l(R,{shadow:"never",class:"search-form"},{default:t(()=>[l(N,{inline:!0,onSubmit:ve(w,["prevent"])},{default:t(()=>[l(r,{label:"客户名称"},{default:t(()=>[l(s,{modelValue:u.name,"onUpdate:modelValue":a[0]||(a[0]=e=>u.name=e),placeholder:"请输入客户名称",clearable:"",onKeyup:P(w,["enter"]),style:{width:"180px"}},null,8,["modelValue"])]),_:1}),l(r,{label:"邮箱"},{default:t(()=>[l(s,{modelValue:u.email,"onUpdate:modelValue":a[1]||(a[1]=e=>u.email=e),placeholder:"请输入邮箱",clearable:"",onKeyup:P(w,["enter"]),style:{width:"200px"}},null,8,["modelValue"])]),_:1}),l(r,{label:"手机号"},{default:t(()=>[l(s,{modelValue:u.phone,"onUpdate:modelValue":a[2]||(a[2]=e=>u.phone=e),placeholder:"请输入手机号",clearable:"",onKeyup:P(w,["enter"]),style:{width:"160px"}},null,8,["modelValue"])]),_:1}),l(r,{label:"客户等级"},{default:t(()=>[l(z,{modelValue:u.level,"onUpdate:modelValue":a[3]||(a[3]=e=>u.level=e),placeholder:"请选择等级",clearable:"",style:{width:"140px"}},{default:t(()=>[(d(!0),g(x,null,k(f(L),e=>(d(),h(E,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(r,{label:"客户状态"},{default:t(()=>[l(z,{modelValue:u.status,"onUpdate:modelValue":a[4]||(a[4]=e=>u.status=e),placeholder:"请选择状态",clearable:"",style:{width:"120px"}},{default:t(()=>[(d(!0),g(x,null,k(f(O),e=>(d(),h(E,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(r,null,{default:t(()=>[l(_,{type:"primary",onClick:w},{default:t(()=>[...a[18]||(a[18]=[i("搜索",-1)])]),_:1}),l(_,{onClick:J},{default:t(()=>[...a[19]||(a[19]=[i("重置",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),l(R,{shadow:"never",class:"table-container"},{default:t(()=>[l(de,{data:j.value,style:{width:"100%"},onSelectionChange:Q,border:""},{default:t(()=>[l(p,{type:"selection",width:"55"}),l(p,{prop:"id",label:"客户ID",width:"80",align:"center"}),l(p,{prop:"name",label:"客户名称","min-width":"120","show-overflow-tooltip":""}),l(p,{prop:"email",label:"邮箱","min-width":"180","show-overflow-tooltip":""}),l(p,{prop:"phone",label:"手机号",width:"130",align:"center"}),l(p,{prop:"company",label:"公司","min-width":"160","show-overflow-tooltip":""}),l(p,{label:"等级",width:"100",align:"center"},{default:t(e=>[l(B,{type:oe(e.row.level),size:"small"},{default:t(()=>[i(v(ne(e.row.level)),1)]),_:2},1032,["type"])]),_:1}),l(p,{label:"状态",width:"100",align:"center"},{default:t(e=>[l(B,{type:se(e.row.status),size:"small"},{default:t(()=>[i(v(re(e.row.status)),1)]),_:2},1032,["type"])]),_:1}),l(p,{prop:"totalOrders",label:"订单数",width:"90",align:"center"}),l(p,{prop:"totalSpent",label:"消费金额",width:"110",align:"center"},{default:t(e=>[i(" ¥"+v(e.row.totalSpent.toFixed(2)),1)]),_:1}),l(p,{prop:"tags",label:"标签","min-width":"150",align:"center"},{default:t(e=>[e.row.tags&&e.row.tags.length>0?(d(),g("div",qe,[(d(!0),g(x,null,k(e.row.tags.slice(0,3),T=>(d(),h(B,{key:T,size:"small",class:"mr-1 mb-1"},{default:t(()=>[i(v(T),1)]),_:2},1024))),128)),e.row.tags.length>3?(d(),h(B,{key:0,size:"small",type:"info"},{default:t(()=>[i(" +"+v(e.row.tags.length-3),1)]),_:2},1024)):M("",!0)])):(d(),g("span",Me,"-"))]),_:1}),l(p,{prop:"lastOrderTime",label:"最近订单",width:"160",align:"center"},{default:t(e=>[i(v(e.row.lastOrderTime?ue(e.row.lastOrderTime):"-"),1)]),_:1}),l(p,{label:"操作",width:"200",fixed:"right",align:"center"},{default:t(e=>[F("div",Ae,[l(_,{type:"primary",size:"small",onClick:T=>Y(e.row),class:"mr-2"},{default:t(()=>[l(D,null,{default:t(()=>[l(f(Se))]),_:1}),a[20]||(a[20]=i(" 编辑 ",-1))]),_:1},8,["onClick"]),l(_,{type:e.row.status==="active"?"warning":"success",size:"small",onClick:T=>le(e.row),class:"mr-2"},{default:t(()=>[l(D,null,{default:t(()=>[l(f(Ee))]),_:1}),i(" "+v(e.row.status==="active"?"禁用":"启用"),1)]),_:2},1032,["type","onClick"]),l(_,{type:"danger",size:"small",onClick:T=>Z(e.row)},{default:t(()=>[l(D,null,{default:t(()=>[l(f(A))]),_:1}),a[21]||(a[21]=i(" 删除 ",-1))]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["data"]),b.value.length>0?(d(),g("div",Ke,[F("span",Ge,"已选择 "+v(b.value.length)+" 项",1),l(_,{type:"danger",size:"small",onClick:ee},{default:t(()=>[l(D,null,{default:t(()=>[l(f(A))]),_:1}),a[22]||(a[22]=i(" 批量删除 ",-1))]),_:1})])):M("",!0),F("div",He,[l(ie,{"current-page":m.page,"onUpdate:currentPage":a[5]||(a[5]=e=>m.page=e),"page-size":m.pageSize,"onUpdate:pageSize":a[6]||(a[6]=e=>m.pageSize=e),"page-sizes":[10,20,50,100],total:m.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:w,onCurrentChange:W},null,8,["current-page","page-size","total"])])]),_:1}),l(me,{modelValue:V.value,"onUpdate:modelValue":a[17]||(a[17]=e=>V.value=e),title:S.value?"编辑客户":"新增客户",width:"600px","close-on-click-modal":!1},{footer:t(()=>[F("div",Je,[l(_,{onClick:a[16]||(a[16]=e=>V.value=!1)},{default:t(()=>[...a[23]||(a[23]=[i("取消",-1)])]),_:1}),l(_,{type:"primary",loading:$.value,onClick:ae},{default:t(()=>[i(v(S.value?"保存":"创建"),1)]),_:1},8,["loading"])])]),default:t(()=>[l(N,{ref_key:"formRef",ref:U,model:n,rules:G,"label-width":"100px","status-icon":""},{default:t(()=>[l(r,{label:"客户名称",prop:"name"},{default:t(()=>[l(s,{modelValue:n.name,"onUpdate:modelValue":a[7]||(a[7]=e=>n.name=e),placeholder:"请输入客户名称",maxlength:"50","show-word-limit":""},null,8,["modelValue"])]),_:1}),l(r,{label:"邮箱",prop:"email"},{default:t(()=>[l(s,{modelValue:n.email,"onUpdate:modelValue":a[8]||(a[8]=e=>n.email=e),placeholder:"请输入邮箱地址"},null,8,["modelValue"])]),_:1}),l(r,{label:"手机号",prop:"phone"},{default:t(()=>[l(s,{modelValue:n.phone,"onUpdate:modelValue":a[9]||(a[9]=e=>n.phone=e),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1}),l(r,{label:"公司名称"},{default:t(()=>[l(s,{modelValue:n.company,"onUpdate:modelValue":a[10]||(a[10]=e=>n.company=e),placeholder:"请输入公司名称（选填）"},null,8,["modelValue"])]),_:1}),l(r,{label:"地址",prop:"address"},{default:t(()=>[l(s,{modelValue:n.address,"onUpdate:modelValue":a[11]||(a[11]=e=>n.address=e),placeholder:"请输入地址"},null,8,["modelValue"])]),_:1}),l(pe,{gutter:20},{default:t(()=>[l(q,{span:12},{default:t(()=>[l(r,{label:"客户等级",prop:"level"},{default:t(()=>[l(z,{modelValue:n.level,"onUpdate:modelValue":a[12]||(a[12]=e=>n.level=e),placeholder:"请选择等级",style:{width:"100%"}},{default:t(()=>[(d(!0),g(x,null,k(f(L),e=>(d(),h(E,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1}),l(q,{span:12},{default:t(()=>[l(r,{label:"客户状态",prop:"status"},{default:t(()=>[l(z,{modelValue:n.status,"onUpdate:modelValue":a[13]||(a[13]=e=>n.status=e),placeholder:"请选择状态",style:{width:"100%"}},{default:t(()=>[(d(!0),g(x,null,k(f(O),e=>(d(),h(E,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),l(r,{label:"客户标签"},{default:t(()=>[l(z,{modelValue:n.tags,"onUpdate:modelValue":a[14]||(a[14]=e=>n.tags=e),multiple:"",filterable:"","allow-create":"","default-first-option":"",placeholder:"请选择或输入标签",style:{width:"100%"}},{default:t(()=>[(d(),g(x,null,k(H,e=>l(E,{key:e,label:e,value:e},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),l(r,{label:"备注"},{default:t(()=>[l(s,{modelValue:n.notes,"onUpdate:modelValue":a[15]||(a[15]=e=>n.notes=e),type:"textarea",rows:3,placeholder:"请输入备注信息（选填）",maxlength:"500","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])]),_:1},8,["actions"])}}}),sl=Le(Qe,[["__scopeId","data-v-beba2853"]]);export{sl as default};
