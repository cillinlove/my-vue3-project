/* empty css                  *//* empty css                        *//* empty css                 *//* empty css                        *//* empty css                */import{d as me,r as s,a4 as pe,q as ve,t as U,w as t,b as W,e as a,m as ce,l as fe,E as ge,f as ke,g as T,L as ye,c as $,F as D,G as L,h as we,j as p,x as be,M as Se,N as Ve,I as _e,v as j,y as he,i as C,Q as Ie,ag as qe,S as xe,T as Ne,W as Ue,V as Ce,ah as Ee,n as k,p as S,Y as ze,_ as Fe}from"./index-D3HzW_Px.js";import{P as Ke}from"./PageLayout-C2MZ-4xL.js";import{M as Re,N as Oe,O as We,P as A}from"./api-DmWqOvHR.js";import"./mockData-BJpfVYbw.js";const $e={class:"wms-warehouse"},De={class:"action-buttons"},Le={class:"pagination-container"},Me=me({__name:"WmsWarehouseView",setup(Be){const v=s({productName:"",sku:"",warehouseId:void 0}),i=s({page:1,pageSize:10,total:0}),V=s([]),_=s([]),h=s(!1),I=s(!1),q=s(!1),y=s(!1),E=s(),z=s(),F=s(),n=s({warehouseId:void 0,productName:"",sku:"",quantity:1,minStock:0,maxStock:1e3}),G={warehouseId:[{required:!0,message:"请选择仓库",trigger:"change"}],productName:[{required:!0,message:"请输入商品名称",trigger:"blur"}],sku:[{required:!0,message:"请输入商品SKU",trigger:"blur"}],quantity:[{required:!0,message:"请输入入库数量",trigger:"blur"}],minStock:[{required:!0,message:"请输入安全库存",trigger:"blur"}],maxStock:[{required:!0,message:"请输入最大库存",trigger:"blur"}]},m=s({inventoryId:void 0,quantity:1,remark:""}),Q={inventoryId:[{required:!0,message:"请选择要出库的商品",trigger:"change"}],quantity:[{required:!0,message:"请输入出库数量",trigger:"blur"},{validator:(u,e,d)=>{e<=0?d(new Error("出库数量必须大于0")):c.value&&e>c.value.quantity?d(new Error("出库数量不能超过当前库存")):d()},trigger:"blur"}]},r=s({id:0,warehouseId:0,warehouseName:"",productName:"",sku:"",quantity:0,minStock:0,maxStock:0}),Y={quantity:[{required:!0,message:"请输入当前库存",trigger:"blur"}],minStock:[{required:!0,message:"请输入安全库存",trigger:"blur"}],maxStock:[{required:!0,message:"请输入最大库存",trigger:"blur"}]},c=pe(()=>m.value.inventoryId&&_.value.find(u=>u.id===m.value.inventoryId)||null),H=async()=>{try{const u=await Re({page:1,pageSize:100});V.value=u.list}catch{k.error("获取仓库列表失败")}},w=async()=>{try{const u={productName:v.value.productName,sku:v.value.sku,warehouseId:v.value.warehouseId,page:i.value.page,pageSize:i.value.pageSize},e=await Oe(u);_.value=e.list,i.value.total=e.total}catch{k.error("获取库存列表失败")}},x=async()=>{i.value.page=1,await w()},J=async()=>{v.value={productName:"",sku:"",warehouseId:void 0},i.value.page=1,await w()},X=async u=>{i.value.pageSize=u,await w()},Z=async u=>{i.value.page=u,await w()},ee=()=>{const u=V.value.length>0?V.value[0]:null;n.value={warehouseId:u?.id,productName:"",sku:"",quantity:1,minStock:0,maxStock:1e3},h.value=!0},ae=async()=>{E.value&&await E.value.validate(async u=>{if(u)try{y.value=!0;const e={warehouseId:n.value.warehouseId,productName:n.value.productName,sku:n.value.sku,quantity:n.value.quantity,minStock:n.value.minStock,maxStock:n.value.maxStock};await We(e),k.success("入库成功"),h.value=!1,await w()}catch(e){k.error("入库失败: "+e.message)}finally{y.value=!1}})},le=async()=>{if(_.value.length===0){k.warning("没有可出库的库存");return}m.value={inventoryId:void 0,quantity:1,remark:""},I.value=!0},te=()=>{c.value&&(m.value.quantity=1)},ue=async()=>{!z.value||!c.value||await z.value.validate(async u=>{if(u)try{y.value=!0;const e=c.value,d={id:e.id,warehouseId:e.warehouseId,productName:e.productName,sku:e.sku,quantity:e.quantity-m.value.quantity,minStock:e.minStock,maxStock:e.maxStock};await A(d),k.success("出库成功"),I.value=!1,await w()}catch(e){k.error("出库失败: "+e.message)}finally{y.value=!1}})},oe=u=>{r.value={id:u.id,warehouseId:u.warehouseId,warehouseName:u.warehouseName,productName:u.productName,sku:u.sku,quantity:u.quantity,minStock:u.minStock,maxStock:u.maxStock},q.value=!0},ne=async()=>{F.value&&await F.value.validate(async u=>{if(u)try{y.value=!0;const e={id:r.value.id,warehouseId:r.value.warehouseId,productName:r.value.productName,sku:r.value.sku,quantity:r.value.quantity,minStock:r.value.minStock,maxStock:r.value.maxStock};await A(e),k.success("库存更新成功"),q.value=!1,await w()}catch(e){k.error("库存更新失败: "+e.message)}finally{y.value=!1}})},re=u=>{k.info("查看库存日志功能开发中")};return ve(async()=>{await H(),await w()}),(u,e)=>{const d=ke,o=ge,K=ze,R=ye,f=we,N=ce,M=be,g=Ve,B=_e,P=he,de=Se,se=xe,b=Ne,O=Ue;return S(),U(Ke,{title:"WMS仓库管理",actions:[{type:"primary",text:"入库",icon:C(Ce),onClick:ee},{type:"warning",text:"出库",icon:C(Ee),onClick:le}]},{default:t(()=>[W("div",$e,[a(M,{shadow:"never",class:"search-form"},{default:t(()=>[a(N,{inline:!0,onSubmit:fe(x,["prevent"])},{default:t(()=>[a(o,{label:"商品名称"},{default:t(()=>[a(d,{modelValue:v.value.productName,"onUpdate:modelValue":e[0]||(e[0]=l=>v.value.productName=l),placeholder:"请输入商品名称",clearable:"",onKeyup:T(x,["enter"])},null,8,["modelValue"])]),_:1}),a(o,{label:"商品SKU"},{default:t(()=>[a(d,{modelValue:v.value.sku,"onUpdate:modelValue":e[1]||(e[1]=l=>v.value.sku=l),placeholder:"请输入商品SKU",clearable:"",onKeyup:T(x,["enter"])},null,8,["modelValue"])]),_:1}),a(o,{label:"仓库"},{default:t(()=>[a(R,{modelValue:v.value.warehouseId,"onUpdate:modelValue":e[2]||(e[2]=l=>v.value.warehouseId=l),placeholder:"请选择仓库",clearable:""},{default:t(()=>[(S(!0),$(L,null,D(V.value,l=>(S(),U(K,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(o,null,{default:t(()=>[a(f,{type:"primary",onClick:x},{default:t(()=>[...e[23]||(e[23]=[p("搜索",-1)])]),_:1}),a(f,{onClick:J},{default:t(()=>[...e[24]||(e[24]=[p("重置",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),a(M,{shadow:"never",class:"table-container"},{default:t(()=>[a(de,{data:_.value,stripe:"",style:{width:"100%"}},{default:t(()=>[a(g,{prop:"id",label:"ID",width:"60",align:"center"}),a(g,{prop:"productName",label:"商品名称","min-width":"200"}),a(g,{prop:"sku",label:"商品SKU",width:"150",align:"center"}),a(g,{prop:"warehouseName",label:"仓库",width:"120",align:"center"},{default:t(l=>[a(B,{type:"primary"},{default:t(()=>[p(j(l.row.warehouseName),1)]),_:2},1024)]),_:1}),a(g,{prop:"quantity",label:"当前库存",width:"120",align:"center"}),a(g,{prop:"minStock",label:"安全库存",width:"120",align:"center"}),a(g,{prop:"maxStock",label:"最大库存",width:"120",align:"center"}),a(g,{prop:"status",label:"状态",width:"120",align:"center"},{default:t(l=>[a(B,{type:{normal:"success",low:"danger",high:"warning"}[l.row.status]},{default:t(()=>[p(j({normal:"正常",low:"库存不足",high:"库存溢出"}[l.row.status]),1)]),_:2},1032,["type"])]),_:1}),a(g,{prop:"updatedAt",label:"最后更新",width:"180"}),a(g,{label:"操作",width:"240",fixed:"right",align:"center"},{default:t(l=>[W("div",De,[a(f,{type:"primary",size:"small",onClick:ie=>oe(l.row)},{default:t(()=>[a(P,null,{default:t(()=>[a(C(Ie))]),_:1}),e[25]||(e[25]=p(" 编辑库存 ",-1))]),_:1},8,["onClick"]),a(f,{type:"info",size:"small",onClick:ie=>re(l.row)},{default:t(()=>[a(P,null,{default:t(()=>[a(C(qe))]),_:1}),e[26]||(e[26]=p(" 库存日志 ",-1))]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["data"])]),_:1}),W("div",Le,[a(se,{"current-page":i.value.page,"onUpdate:currentPage":e[3]||(e[3]=l=>i.value.page=l),"page-size":i.value.pageSize,"onUpdate:pageSize":e[4]||(e[4]=l=>i.value.pageSize=l),"page-sizes":[10,20,50,100],total:i.value.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:X,onCurrentChange:Z},null,8,["current-page","page-size","total"])]),a(O,{modelValue:h.value,"onUpdate:modelValue":e[12]||(e[12]=l=>h.value=l),title:"入库",width:"500px","close-on-click-modal":!1},{footer:t(()=>[a(f,{onClick:e[11]||(e[11]=l=>h.value=!1)},{default:t(()=>[...e[27]||(e[27]=[p("取消",-1)])]),_:1}),a(f,{type:"primary",loading:y.value,onClick:ae},{default:t(()=>[...e[28]||(e[28]=[p(" 确定入库 ",-1)])]),_:1},8,["loading"])]),default:t(()=>[a(N,{ref_key:"stockInFormRef",ref:E,model:n.value,rules:G,"label-width":"100px"},{default:t(()=>[a(o,{label:"仓库",prop:"warehouseId"},{default:t(()=>[a(R,{modelValue:n.value.warehouseId,"onUpdate:modelValue":e[5]||(e[5]=l=>n.value.warehouseId=l),placeholder:"请选择仓库",style:{width:"100%"}},{default:t(()=>[(S(!0),$(L,null,D(V.value,l=>(S(),U(K,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(o,{label:"商品名称",prop:"productName"},{default:t(()=>[a(d,{modelValue:n.value.productName,"onUpdate:modelValue":e[6]||(e[6]=l=>n.value.productName=l),placeholder:"请输入商品名称"},null,8,["modelValue"])]),_:1}),a(o,{label:"商品SKU",prop:"sku"},{default:t(()=>[a(d,{modelValue:n.value.sku,"onUpdate:modelValue":e[7]||(e[7]=l=>n.value.sku=l),placeholder:"请输入商品SKU"},null,8,["modelValue"])]),_:1}),a(o,{label:"入库数量",prop:"quantity"},{default:t(()=>[a(b,{modelValue:n.value.quantity,"onUpdate:modelValue":e[8]||(e[8]=l=>n.value.quantity=l),min:1,max:999999,placeholder:"请输入入库数量",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),a(o,{label:"安全库存",prop:"minStock"},{default:t(()=>[a(b,{modelValue:n.value.minStock,"onUpdate:modelValue":e[9]||(e[9]=l=>n.value.minStock=l),min:0,max:999999,placeholder:"请输入安全库存",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),a(o,{label:"最大库存",prop:"maxStock"},{default:t(()=>[a(b,{modelValue:n.value.maxStock,"onUpdate:modelValue":e[10]||(e[10]=l=>n.value.maxStock=l),min:0,max:999999,placeholder:"请输入最大库存",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),a(O,{modelValue:I.value,"onUpdate:modelValue":e[17]||(e[17]=l=>I.value=l),title:"出库",width:"500px","close-on-click-modal":!1},{footer:t(()=>[a(f,{onClick:e[16]||(e[16]=l=>I.value=!1)},{default:t(()=>[...e[29]||(e[29]=[p("取消",-1)])]),_:1}),a(f,{type:"warning",loading:y.value,onClick:ue},{default:t(()=>[...e[30]||(e[30]=[p(" 确定出库 ",-1)])]),_:1},8,["loading"])]),default:t(()=>[a(N,{ref_key:"stockOutFormRef",ref:z,model:m.value,rules:Q,"label-width":"100px"},{default:t(()=>[a(o,{label:"选择商品",prop:"inventoryId"},{default:t(()=>[a(R,{modelValue:m.value.inventoryId,"onUpdate:modelValue":e[13]||(e[13]=l=>m.value.inventoryId=l),placeholder:"请选择要出库的商品",style:{width:"100%"},onChange:te},{default:t(()=>[(S(!0),$(L,null,D(_.value,l=>(S(),U(K,{key:l.id,label:`${l.productName} (${l.sku}) - 当前库存: ${l.quantity}`,value:l.id,disabled:l.quantity<=0},null,8,["label","value","disabled"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(o,{label:"商品名称"},{default:t(()=>[a(d,{value:c.value?.productName||"",disabled:""},null,8,["value"])]),_:1}),a(o,{label:"商品SKU"},{default:t(()=>[a(d,{value:c.value?.sku||"",disabled:""},null,8,["value"])]),_:1}),a(o,{label:"仓库"},{default:t(()=>[a(d,{value:c.value?.warehouseName||"",disabled:""},null,8,["value"])]),_:1}),a(o,{label:"当前库存"},{default:t(()=>[a(d,{value:c.value?.quantity?.toString()||"0",disabled:""},null,8,["value"])]),_:1}),a(o,{label:"出库数量",prop:"quantity"},{default:t(()=>[a(b,{modelValue:m.value.quantity,"onUpdate:modelValue":e[14]||(e[14]=l=>m.value.quantity=l),min:1,max:c.value?.quantity??999999,placeholder:"请输入出库数量",style:{width:"100%"}},null,8,["modelValue","max"])]),_:1}),a(o,{label:"出库原因",prop:"remark"},{default:t(()=>[a(d,{modelValue:m.value.remark,"onUpdate:modelValue":e[15]||(e[15]=l=>m.value.remark=l),type:"textarea",rows:3,placeholder:"请输入出库原因（可选）"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),a(O,{modelValue:q.value,"onUpdate:modelValue":e[22]||(e[22]=l=>q.value=l),title:"编辑库存",width:"500px","close-on-click-modal":!1},{footer:t(()=>[a(f,{onClick:e[21]||(e[21]=l=>q.value=!1)},{default:t(()=>[...e[31]||(e[31]=[p("取消",-1)])]),_:1}),a(f,{type:"primary",loading:y.value,onClick:ne},{default:t(()=>[...e[32]||(e[32]=[p(" 保存修改 ",-1)])]),_:1},8,["loading"])]),default:t(()=>[a(N,{ref_key:"editStockFormRef",ref:F,model:r.value,rules:Y,"label-width":"100px"},{default:t(()=>[a(o,{label:"商品名称"},{default:t(()=>[a(d,{value:r.value.productName,disabled:""},null,8,["value"])]),_:1}),a(o,{label:"商品SKU"},{default:t(()=>[a(d,{value:r.value.sku,disabled:""},null,8,["value"])]),_:1}),a(o,{label:"仓库"},{default:t(()=>[a(d,{value:r.value.warehouseName,disabled:""},null,8,["value"])]),_:1}),a(o,{label:"当前库存",prop:"quantity"},{default:t(()=>[a(b,{modelValue:r.value.quantity,"onUpdate:modelValue":e[18]||(e[18]=l=>r.value.quantity=l),min:0,max:999999,placeholder:"请输入当前库存",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),a(o,{label:"安全库存",prop:"minStock"},{default:t(()=>[a(b,{modelValue:r.value.minStock,"onUpdate:modelValue":e[19]||(e[19]=l=>r.value.minStock=l),min:0,max:999999,placeholder:"请输入安全库存",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),a(o,{label:"最大库存",prop:"maxStock"},{default:t(()=>[a(b,{modelValue:r.value.maxStock,"onUpdate:modelValue":e[20]||(e[20]=l=>r.value.maxStock=l),min:0,max:999999,placeholder:"请输入最大库存",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])]),_:1},8,["actions"])}}}),Xe=Fe(Me,[["__scopeId","data-v-4bc4e951"]]);export{Xe as default};
