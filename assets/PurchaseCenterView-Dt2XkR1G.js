/* empty css                  *//* empty css                        *//* empty css               *//* empty css                 *//* empty css                */import{d as L,r as p,a as pe,a7 as R,t as j,m as J,w as l,e,c as me,C as ce,E as G,f as H,U as ve,K as fe,y as Q,P as W,F as ge,p as P,_ as X,q as _e,b as F,l as De,g as q,h as ye,j as f,x as be,A as we,B as Ve,v as K,Q as he,G as xe,i as M,H as Ne,I as Ce,J as Ee,N as ke,M as Fe,n as m,O as Ae}from"./index-BSOYK04B.js";import{P as Se}from"./PageLayout-53LlZDnx.js";/* empty css                        *//* empty css                             */import{I as Ue,J as ze,K as Me,L as Pe}from"./api-DmWqOvHR.js";import"./mockData-BJpfVYbw.js";const Ye=L({__name:"ProcurementOrderForm",props:{order:{},isEdit:{type:Boolean}},emits:["update:formData"],setup(S,{expose:d,emit:u}){const D=S,V=u,g=p(),a=pe({supplierName:"",orderDate:"",expectedDeliveryDate:"",totalAmount:0,status:"pending",actualDeliveryDate:"",remark:""}),y={supplierName:[{required:!0,message:"请输入供应商名称",trigger:"blur"},{min:2,max:100,message:"供应商名称长度在2-100个字符之间",trigger:"blur"}],orderDate:[{required:!0,message:"请选择订单日期",trigger:"change"}],expectedDeliveryDate:[{required:!0,message:"请选择预计交货日期",trigger:"change"}],totalAmount:[{required:!0,message:"请输入订单金额",trigger:"blur"},{validator:(i,n,b)=>{n<0?b(new Error("订单金额不能为负数")):b()},trigger:"blur"}],status:[{required:!0,message:"请选择订单状态",trigger:"change"}]};R(()=>D.order,i=>{i&&D.isEdit&&(a.supplierName=i.supplierName,a.orderDate=i.orderDate,a.expectedDeliveryDate=i.expectedDeliveryDate,a.totalAmount=i.totalAmount,a.status=i.status,a.actualDeliveryDate=i.actualDeliveryDate||"",a.remark="")},{immediate:!0}),R(a,()=>{x()},{deep:!0});const x=()=>{D.isEdit&&D.order?V("update:formData",{id:D.order.id,supplierName:a.supplierName,totalAmount:a.totalAmount,status:a.status,expectedDeliveryDate:a.expectedDeliveryDate,actualDeliveryDate:a.actualDeliveryDate||void 0}):V("update:formData",{supplierName:a.supplierName,totalAmount:a.totalAmount,orderDate:a.orderDate,expectedDeliveryDate:a.expectedDeliveryDate,items:[]})};return d({validate:async()=>g.value?await g.value.validate().then(()=>!0).catch(()=>!1):!1,resetForm:()=>{g.value?.resetFields(),a.supplierName="",a.orderDate="",a.expectedDeliveryDate="",a.totalAmount=0,a.status="pending",a.actualDeliveryDate="",a.remark=""}}),(i,n)=>{const b=H,_=G,E=ve,c=fe,v=W,U=Q,z=J;return P(),j(z,{ref_key:"formRef",ref:g,model:a,rules:y,"label-width":"100px",class:"procurement-form"},{default:l(()=>[e(_,{label:"供应商",prop:"supplierName"},{default:l(()=>[e(b,{modelValue:a.supplierName,"onUpdate:modelValue":n[0]||(n[0]=s=>a.supplierName=s),placeholder:"请输入供应商名称",clearable:""},null,8,["modelValue"])]),_:1}),e(_,{label:"订单日期",prop:"orderDate"},{default:l(()=>[e(E,{modelValue:a.orderDate,"onUpdate:modelValue":n[1]||(n[1]=s=>a.orderDate=s),type:"date",placeholder:"请选择订单日期","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),e(_,{label:"预计交货日期",prop:"expectedDeliveryDate"},{default:l(()=>[e(E,{modelValue:a.expectedDeliveryDate,"onUpdate:modelValue":n[2]||(n[2]=s=>a.expectedDeliveryDate=s),type:"date",placeholder:"请选择预计交货日期","value-format":"YYYY-MM-DD",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),e(_,{label:"订单金额",prop:"totalAmount"},{default:l(()=>[e(c,{modelValue:a.totalAmount,"onUpdate:modelValue":n[3]||(n[3]=s=>a.totalAmount=s),precision:2,min:0,step:100,max:99999999,placeholder:"请输入订单金额",style:{width:"100%"}},null,8,["modelValue"])]),_:1}),S.isEdit?(P(),me(ge,{key:0},[e(_,{label:"订单状态",prop:"status"},{default:l(()=>[e(U,{modelValue:a.status,"onUpdate:modelValue":n[4]||(n[4]=s=>a.status=s),placeholder:"请选择订单状态",style:{width:"100%"}},{default:l(()=>[e(v,{label:"待审批",value:"pending"}),e(v,{label:"已审批",value:"approved"}),e(v,{label:"已采购",value:"purchased"}),e(v,{label:"已完成",value:"completed"}),e(v,{label:"已取消",value:"cancelled"})]),_:1},8,["modelValue"])]),_:1}),e(_,{label:"实际交货日期",prop:"actualDeliveryDate"},{default:l(()=>[e(E,{modelValue:a.actualDeliveryDate,"onUpdate:modelValue":n[5]||(n[5]=s=>a.actualDeliveryDate=s),type:"date",placeholder:"请选择实际交货日期（可选）","value-format":"YYYY-MM-DD",style:{width:"100%"},clearable:""},null,8,["modelValue"])]),_:1})],64)):ce("",!0),e(_,{label:"备注"},{default:l(()=>[e(b,{modelValue:a.remark,"onUpdate:modelValue":n[6]||(n[6]=s=>a.remark=s),type:"textarea",rows:3,placeholder:"请输入备注信息（可选）",maxlength:"500","show-word-limit":""},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])}}}),$=X(Ye,[["__scopeId","data-v-5d11109e"]]),Be={class:"purchase-center"},Ie={class:"action-buttons"},Te={class:"pagination-container"},Re={class:"dialog-footer"},qe={class:"dialog-footer"},Ke=L({__name:"PurchaseCenterView",setup(S){const d=p({orderNo:"",supplierName:"",status:void 0}),u=p({page:1,pageSize:10,total:0}),D=p([]),V=p(!1),g=p(null),a=p(null),y=p(!1),x=p(!1),N=p(null),C=p(null),i=p(),n=()=>{g.value?.resetForm(),a.value=null,V.value=!1},b=()=>{N.value?.resetForm(),C.value=null,i.value=void 0,x.value=!1},_=o=>({pending:"待审批",approved:"已审批",purchased:"已采购",completed:"已完成",cancelled:"已取消"})[o]||o,E=o=>({pending:"warning",approved:"info",purchased:"primary",completed:"success",cancelled:"danger"})[o]||"default",c=async()=>{try{const o={orderNo:d.value.orderNo,supplierName:d.value.supplierName,status:d.value.status,page:u.value.page,pageSize:u.value.pageSize},t=await Ue(o);D.value=t.list,u.value.total=t.total}catch{m.error("获取采购订单失败")}},v=async()=>{u.value.page=1,await c()},U=async()=>{d.value={orderNo:"",supplierName:"",status:void 0},u.value.page=1,await c()},z=async o=>{u.value.pageSize=o,await c()},s=async o=>{u.value.page=o,await c()},Z=()=>{V.value=!0},O=o=>{a.value=o},ee=async()=>{if(!g.value){m.error("表单组件未加载完成，请重试");return}if(await g.value.validate()){if(!a.value){m.warning("请填写完整的订单信息");return}y.value=!0;try{await ze(a.value),m.success("新增采购订单成功"),n(),await c()}catch(t){m.error("新增失败："+(t.message||"未知错误"))}finally{y.value=!1}}},ae=o=>{i.value=o,x.value=!0},te=o=>{C.value=o},le=async()=>{if(!N.value){m.error("表单组件未加载完成，请重试");return}if(await N.value.validate()){if(!C.value){m.warning("请填写完整的订单信息");return}y.value=!0;try{await Me(C.value),m.success("保存成功"),b(),await c()}catch(t){m.error("保存失败："+(t.message||"未知错误"))}finally{y.value=!1}}},oe=async o=>{try{await Ae.confirm(`确定要删除采购订单「${o.orderNo}」吗？此操作不可撤销。`,"删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning",customClass:"delete-confirm-message-box",confirmButtonClass:"delete-confirm-btn",distinguishCancelAndClose:!0,autofocus:!1}),await Pe(o.id),m.success("删除成功"),await c()}catch(t){t!=="cancel"&&t!=="close"&&m.error("删除失败："+(t.message||"未知错误"))}};return _e(async()=>{await c()}),(o,t)=>{const Y=H,A=G,k=W,re=Q,w=ye,ne=J,B=be,h=Ve,se=he,I=xe,ue=we,ie=Ee,T=ke;return P(),j(Se,{title:"采购中心",actions:[{type:"primary",text:"新增采购订单",icon:M(Fe),onClick:Z}]},{default:l(()=>[F("div",Be,[e(B,{shadow:"never",class:"search-form"},{default:l(()=>[e(ne,{inline:!0,onSubmit:De(v,["prevent"])},{default:l(()=>[e(A,{label:"订单编号"},{default:l(()=>[e(Y,{modelValue:d.value.orderNo,"onUpdate:modelValue":t[0]||(t[0]=r=>d.value.orderNo=r),placeholder:"请输入订单编号",clearable:"",onKeyup:q(v,["enter"])},null,8,["modelValue"])]),_:1}),e(A,{label:"供应商"},{default:l(()=>[e(Y,{modelValue:d.value.supplierName,"onUpdate:modelValue":t[1]||(t[1]=r=>d.value.supplierName=r),placeholder:"请输入供应商名称",clearable:"",onKeyup:q(v,["enter"])},null,8,["modelValue"])]),_:1}),e(A,{label:"订单状态"},{default:l(()=>[e(re,{modelValue:d.value.status,"onUpdate:modelValue":t[2]||(t[2]=r=>d.value.status=r),placeholder:"请选择订单状态",clearable:""},{default:l(()=>[e(k,{label:"待审批",value:"pending"}),e(k,{label:"已审批",value:"approved"}),e(k,{label:"已采购",value:"purchased"}),e(k,{label:"已完成",value:"completed"}),e(k,{label:"已取消",value:"cancelled"})]),_:1},8,["modelValue"])]),_:1}),e(A,null,{default:l(()=>[e(w,{type:"primary",onClick:v},{default:l(()=>[...t[7]||(t[7]=[f("搜索",-1)])]),_:1}),e(w,{onClick:U},{default:l(()=>[...t[8]||(t[8]=[f("重置",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),e(B,{shadow:"never",class:"table-container"},{default:l(()=>[e(ue,{data:D.value,border:"",style:{width:"100%"}},{default:l(()=>[e(h,{prop:"id",label:"ID",width:"60",align:"center"}),e(h,{prop:"orderNo",label:"订单编号",width:"180"}),e(h,{prop:"supplierName",label:"供应商","min-width":"150"}),e(h,{prop:"totalAmount",label:"订单金额",width:"120",align:"center"},{default:l(r=>[f(" ¥"+K(r.row.totalAmount.toFixed(2)),1)]),_:1}),e(h,{prop:"status",label:"状态",width:"100",align:"center"},{default:l(r=>[e(se,{type:E(r.row.status)},{default:l(()=>[f(K(_(r.row.status)),1)]),_:2},1032,["type"])]),_:1}),e(h,{prop:"createdAt",label:"创建时间",width:"180"}),e(h,{label:"操作",width:"200",fixed:"right",align:"center"},{default:l(r=>[F("div",Ie,[e(w,{type:"primary",size:"small",onClick:de=>ae(r.row)},{default:l(()=>[e(I,null,{default:l(()=>[e(M(Ne))]),_:1}),t[9]||(t[9]=f(" 编辑 ",-1))]),_:1},8,["onClick"]),e(w,{type:"danger",size:"small",onClick:de=>oe(r.row)},{default:l(()=>[e(I,null,{default:l(()=>[e(M(Ce))]),_:1}),t[10]||(t[10]=f(" 删除 ",-1))]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["data"])]),_:1}),F("div",Te,[e(ie,{"current-page":u.value.page,"onUpdate:currentPage":t[3]||(t[3]=r=>u.value.page=r),"page-size":u.value.pageSize,"onUpdate:pageSize":t[4]||(t[4]=r=>u.value.pageSize=r),"page-sizes":[10,20,50,100],total:u.value.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:z,onCurrentChange:s},null,8,["current-page","page-size","total"])]),e(T,{modelValue:V.value,"onUpdate:modelValue":t[5]||(t[5]=r=>V.value=r),title:"新增采购订单",width:"600px","close-on-click-modal":!1},{footer:l(()=>[F("div",Re,[e(w,{onClick:n},{default:l(()=>[...t[11]||(t[11]=[f("取消",-1)])]),_:1}),e(w,{type:"primary",onClick:ee,loading:y.value},{default:l(()=>[...t[12]||(t[12]=[f(" 确定 ",-1)])]),_:1},8,["loading"])])]),default:l(()=>[e($,{ref_key:"addFormRef",ref:g,"is-edit":!1,"onUpdate:formData":O},null,512)]),_:1},8,["modelValue"]),e(T,{modelValue:x.value,"onUpdate:modelValue":t[6]||(t[6]=r=>x.value=r),title:"编辑采购订单",width:"600px","close-on-click-modal":!1},{footer:l(()=>[F("div",qe,[e(w,{onClick:b},{default:l(()=>[...t[13]||(t[13]=[f("取消",-1)])]),_:1}),e(w,{type:"primary",onClick:le,loading:y.value},{default:l(()=>[...t[14]||(t[14]=[f(" 保存 ",-1)])]),_:1},8,["loading"])])]),default:l(()=>[e($,{ref_key:"editFormRef",ref:N,order:i.value,"is-edit":!0,"onUpdate:formData":te},null,8,["order"])]),_:1},8,["modelValue"])])]),_:1},8,["actions"])}}}),ea=X(Ke,[["__scopeId","data-v-389c3b19"]]);export{ea as default};
