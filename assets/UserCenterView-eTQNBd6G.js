/* empty css                  *//* empty css                        *//* empty css               *//* empty css                 *//* empty css                  *//* empty css                */import{d as me,r as d,a as pe,q as ce,t as M,w as l,e as a,b as f,m as ve,l as ge,E as fe,f as _e,g as x,y as ye,P as we,h as be,j as i,x as Ve,A as he,B as Ce,Q as Ue,v as E,$ as ke,G as xe,i as P,H as Ee,a0 as ze,I as Se,J as Pe,a1 as $e,a2 as De,a3 as Be,N as Ie,C as Te,M as qe,n as r,O as Ae,p as N,_ as Ke}from"./index-BSOYK04B.js";import{P as Fe}from"./PageLayout-53LlZDnx.js";import{s as Me,v as R,w as Ne,x as Re,n as je,y as Le,z as Oe}from"./api-DmWqOvHR.js";import"./mockData-BJpfVYbw.js";const Qe={class:"action-buttons"},Ge={class:"pagination-container"},He={class:"permission-assignment"},Je={class:"permission-list"},We={class:"permission-tree-node"},Xe={class:"permission-code"},Ye={class:"dialog-footer"},Ze={class:"dialog-footer"},ea=me({__name:"UserCenterView",setup(aa){const _=async()=>{try{const s={page:u.value.page,pageSize:u.value.pageSize,username:c.value.username,phone:c.value.phone,status:c.value.status},e=await Me(s);T.value=e.list,u.value.total=e.total}catch(s){r.error("获取用户列表失败："+(s.message||"未知错误"))}},c=d({username:"",phone:"",status:void 0}),u=d({page:1,pageSize:10,total:0}),T=d([]),w=d(!1),b=d(!1),$=d(!1),U=d(),o=pe({id:void 0,username:"",email:"",phone:"",password:"",role:"user",status:"active",permissions:[]}),j={username:[{required:!0,message:"请输入用户名称",trigger:"blur"},{min:2,max:50,message:"用户名称长度在 2 到 50 个字符之间",trigger:"blur"}],email:[{required:!0,message:"请输入邮箱地址",trigger:"blur"},{type:"email",message:"请输入有效的邮箱地址",trigger:"blur"}],phone:[{required:!0,message:"请输入手机号",trigger:"blur"},{pattern:/^1[3-9]\d{9}$/,message:"请输入有效的手机号",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:20,message:"密码长度在 6 到 20 个字符之间",trigger:"blur"}],role:[{required:!0,message:"请选择角色",trigger:"change"}],status:[{required:!0,message:"请选择状态",trigger:"change"}]},z=async()=>{u.value.page=1,await _(),r.success("搜索完成")},L=async()=>{c.value={username:"",phone:"",status:void 0},u.value.page=1,await _(),r.success("重置完成")},O=async s=>{u.value.pageSize=s,await _()},Q=async s=>{u.value.page=s,await _()},G=()=>{b.value=!1,J(),w.value=!0},H=s=>{b.value=!0,Object.assign(o,{id:s.id,username:s.username,email:s.email,phone:s.phone,password:"",role:s.role,status:s.status,permissions:[...s.permissions]}),w.value=!0},J=()=>{o.id=void 0,o.username="",o.email="",o.phone="",o.password="",o.role="user",o.status="active",o.permissions=[],U.value&&U.value.resetFields()},W=async()=>{if(U.value)try{if(await U.value.validate(),$.value=!0,b.value&&o.id){const s={id:o.id,username:o.username,email:o.email,phone:o.phone,role:o.role,status:o.status,permissions:o.permissions};await R(s),w.value=!1,r.success("用户更新成功"),await _()}else{const s={username:o.username,email:o.email,phone:o.phone,password:o.password,role:o.role,status:o.status,permissions:o.permissions};await Ne(s),w.value=!1,r.success("用户创建成功"),await _()}}catch(s){s!==!1&&(r.error(b.value?"更新用户失败":"创建用户失败"),console.error(s))}finally{$.value=!1}},X=async s=>{try{await Ae.confirm(`确定要删除用户「${s.username}」吗？此操作不可撤销。`,"删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning",distinguishCancelAndClose:!0,confirmButtonClass:"delete-confirm-btn"}),await Re(s.id),await _(),r.success("删除成功")}catch(e){e!=="cancel"&&e!=="close"&&(r.error("删除失败："+(e.message||"未知错误")),console.error("删除用户失败:",e))}},Y=async s=>{try{const e={...s,status:s.status};await R(e),r.success(`用户「${s.username}」状态已更新为${s.status==="active"?"启用":"禁用"}`)}catch(e){r.error("状态更新失败："+(e.message||"未知错误"))}},k=d(!1),S=d(null),q=d([]),V=d([]),v=d({page:1,pageSize:100,name:"",code:"",module:""}),Z={label:"name",children:"children"},ee=async s=>{S.value=s,await h(),await ae(s.id),k.value=!0},h=async()=>{try{const s=await je(v.value);q.value=s.list}catch(s){r.error("获取权限列表失败："+(s.message||"未知错误"))}},ae=async s=>{try{const e=await Le(s);e?V.value=e.permissions:V.value=[]}catch(e){r.error("加载用户权限失败："+(e.message||"未知错误")),V.value=[]}},le=()=>{v.value={page:1,pageSize:100,name:"",code:"",module:""},h()},te=()=>{},se=async()=>{if(S.value)try{await Oe({userId:S.value.id,permissionIds:V.value}),k.value=!1,r.success("权限分配成功")}catch(s){r.error("权限分配失败："+(s.message||"未知错误"))}};return ce(async()=>{await _()}),(s,e)=>{const g=_e,n=fe,C=we,D=ye,m=be,B=ve,A=Ve,y=Ce,K=Ue,oe=ke,I=xe,ne=he,re=Pe,ie=Be,ue=De,de=$e,F=Ie;return N(),M(Fe,{title:"用户中心",actions:[{type:"primary",text:"新增用户",icon:P(qe),onClick:G}]},{default:l(()=>[a(A,{shadow:"never",class:"search-form"},{default:l(()=>[a(B,{inline:!0,onSubmit:ge(z,["prevent"])},{default:l(()=>[a(n,{label:"用户名称"},{default:l(()=>[a(g,{modelValue:c.value.username,"onUpdate:modelValue":e[0]||(e[0]=t=>c.value.username=t),placeholder:"请输入用户名称",clearable:"",onKeyup:x(z,["enter"])},null,8,["modelValue"])]),_:1}),a(n,{label:"电话"},{default:l(()=>[a(g,{modelValue:c.value.phone,"onUpdate:modelValue":e[1]||(e[1]=t=>c.value.phone=t),placeholder:"请输入电话",clearable:"",onKeyup:x(z,["enter"])},null,8,["modelValue"])]),_:1}),a(n,{label:"用户状态"},{default:l(()=>[a(D,{modelValue:c.value.status,"onUpdate:modelValue":e[2]||(e[2]=t=>c.value.status=t),placeholder:"请选择用户状态",clearable:""},{default:l(()=>[a(C,{label:"启用",value:"active"}),a(C,{label:"禁用",value:"inactive"})]),_:1},8,["modelValue"])]),_:1}),a(n,null,{default:l(()=>[a(m,{type:"primary",onClick:z},{default:l(()=>[...e[19]||(e[19]=[i("搜索",-1)])]),_:1}),a(m,{onClick:L},{default:l(()=>[...e[20]||(e[20]=[i("重置",-1)])]),_:1})]),_:1})]),_:1})]),_:1}),a(A,{shadow:"never",class:"table-container"},{default:l(()=>[a(ne,{data:T.value,border:"",style:{width:"100%"}},{default:l(()=>[a(y,{prop:"id",label:"用户ID",width:"80",align:"center"}),a(y,{prop:"username",label:"用户名称","min-width":"150"}),a(y,{prop:"email",label:"邮箱","min-width":"200"}),a(y,{prop:"phone",label:"电话",width:"150"}),a(y,{prop:"role",label:"角色",width:"100",align:"center"},{default:l(t=>[a(K,{type:t.row.role==="admin"?"primary":"success"},{default:l(()=>[i(E(t.row.role==="admin"?"管理员":"普通用户"),1)]),_:2},1032,["type"])]),_:1}),a(y,{prop:"status",label:"状态",width:"100",align:"center"},{default:l(t=>[a(oe,{modelValue:t.row.status,"onUpdate:modelValue":p=>t.row.status=p,"active-value":"active","inactive-value":"inactive",onChange:p=>Y(t.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),a(y,{prop:"createdAt",label:"创建时间",width:"180"}),a(y,{label:"操作",width:"250",fixed:"right",align:"center"},{default:l(t=>[f("div",Qe,[a(m,{type:"primary",size:"small",onClick:p=>H(t.row)},{default:l(()=>[a(I,null,{default:l(()=>[a(P(Ee))]),_:1}),e[21]||(e[21]=i(" 编辑 ",-1))]),_:1},8,["onClick"]),a(m,{type:"success",size:"small",onClick:p=>ee(t.row)},{default:l(()=>[a(I,null,{default:l(()=>[a(P(ze))]),_:1}),e[22]||(e[22]=i(" 分配权限 ",-1))]),_:1},8,["onClick"]),a(m,{type:"danger",size:"small",onClick:p=>X(t.row)},{default:l(()=>[a(I,null,{default:l(()=>[a(P(Se))]),_:1}),e[23]||(e[23]=i(" 删除 ",-1))]),_:1},8,["onClick"])])]),_:1})]),_:1},8,["data"])]),_:1}),f("div",Ge,[a(re,{"current-page":u.value.page,"onUpdate:currentPage":e[3]||(e[3]=t=>u.value.page=t),"page-size":u.value.pageSize,"onUpdate:pageSize":e[4]||(e[4]=t=>u.value.pageSize=t),"page-sizes":[10,20,50,100],total:u.value.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:O,onCurrentChange:Q},null,8,["current-page","page-size","total"])]),a(F,{modelValue:k.value,"onUpdate:modelValue":e[10]||(e[10]=t=>k.value=t),title:`为用户 ${S.value?.username} 分配权限`,width:"800px","destroy-on-close":""},{footer:l(()=>[f("span",Ye,[a(m,{onClick:e[9]||(e[9]=t=>k.value=!1)},{default:l(()=>[...e[26]||(e[26]=[i("取消",-1)])]),_:1}),a(m,{type:"primary",onClick:se},{default:l(()=>[...e[27]||(e[27]=[i("保存权限",-1)])]),_:1})])]),default:l(()=>[f("div",He,[a(B,{model:v.value,layout:"inline",size:"small",class:"permission-filter"},{default:l(()=>[a(n,{label:"权限名称"},{default:l(()=>[a(g,{modelValue:v.value.name,"onUpdate:modelValue":e[5]||(e[5]=t=>v.value.name=t),placeholder:"请输入权限名称",clearable:"",onKeyup:x(h,["enter"])},null,8,["modelValue"])]),_:1}),a(n,{label:"权限编码"},{default:l(()=>[a(g,{modelValue:v.value.code,"onUpdate:modelValue":e[6]||(e[6]=t=>v.value.code=t),placeholder:"请输入权限编码",clearable:"",onKeyup:x(h,["enter"])},null,8,["modelValue"])]),_:1}),a(n,{label:"所属模块"},{default:l(()=>[a(g,{modelValue:v.value.module,"onUpdate:modelValue":e[7]||(e[7]=t=>v.value.module=t),placeholder:"请输入所属模块",clearable:"",onKeyup:x(h,["enter"])},null,8,["modelValue"])]),_:1}),a(n,null,{default:l(()=>[a(m,{type:"primary",onClick:h},{default:l(()=>[...e[24]||(e[24]=[i("查询",-1)])]),_:1}),a(m,{onClick:le},{default:l(()=>[...e[25]||(e[25]=[i("重置",-1)])]),_:1})]),_:1})]),_:1},8,["model"]),f("div",Je,[a(de,{height:"400px"},{default:l(()=>[a(ue,{modelValue:V.value,"onUpdate:modelValue":e[8]||(e[8]=t=>V.value=t)},{default:l(()=>[a(ie,{data:q.value,props:Z,"show-checkbox":"","default-expand-all":"","node-key":"id","check-strictly":!1,onCheck:te},{default:l(({node:t,data:p})=>[f("div",We,[f("span",null,E(t.label),1),f("span",Xe,E(p.code),1),a(K,{type:p.type==="menu"?"primary":p.type==="button"?"success":"warning",size:"small",class:"permission-type-tag"},{default:l(()=>[i(E(p.type==="menu"?"菜单":p.type==="button"?"按钮":"API"),1)]),_:2},1032,["type"])])]),_:1},8,["data"])]),_:1},8,["modelValue"])]),_:1})])])]),_:1},8,["modelValue","title"]),a(F,{modelValue:w.value,"onUpdate:modelValue":e[18]||(e[18]=t=>w.value=t),title:b.value?"编辑用户":"新增用户",width:"500px","close-on-click-modal":!1},{footer:l(()=>[f("div",Ze,[a(m,{onClick:e[17]||(e[17]=t=>w.value=!1)},{default:l(()=>[...e[28]||(e[28]=[i("取消",-1)])]),_:1}),a(m,{type:"primary",loading:$.value,onClick:W},{default:l(()=>[i(E(b.value?"保存":"创建"),1)]),_:1},8,["loading"])])]),default:l(()=>[a(B,{ref_key:"formRef",ref:U,model:o,rules:j,"label-width":"100px","status-icon":""},{default:l(()=>[a(n,{label:"用户名称",prop:"username"},{default:l(()=>[a(g,{modelValue:o.username,"onUpdate:modelValue":e[11]||(e[11]=t=>o.username=t),placeholder:"请输入用户名称",maxlength:"50","show-word-limit":""},null,8,["modelValue"])]),_:1}),a(n,{label:"邮箱",prop:"email"},{default:l(()=>[a(g,{modelValue:o.email,"onUpdate:modelValue":e[12]||(e[12]=t=>o.email=t),placeholder:"请输入邮箱地址"},null,8,["modelValue"])]),_:1}),a(n,{label:"手机号",prop:"phone"},{default:l(()=>[a(g,{modelValue:o.phone,"onUpdate:modelValue":e[13]||(e[13]=t=>o.phone=t),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1}),b.value?Te("",!0):(N(),M(n,{key:0,label:"密码",prop:"password"},{default:l(()=>[a(g,{modelValue:o.password,"onUpdate:modelValue":e[14]||(e[14]=t=>o.password=t),type:"password",placeholder:"请输入密码","show-password":""},null,8,["modelValue"])]),_:1})),a(n,{label:"角色",prop:"role"},{default:l(()=>[a(D,{modelValue:o.role,"onUpdate:modelValue":e[15]||(e[15]=t=>o.role=t),placeholder:"请选择角色",style:{width:"100%"}},{default:l(()=>[a(C,{label:"管理员",value:"admin"}),a(C,{label:"普通用户",value:"user"})]),_:1},8,["modelValue"])]),_:1}),a(n,{label:"用户状态",prop:"status"},{default:l(()=>[a(D,{modelValue:o.status,"onUpdate:modelValue":e[16]||(e[16]=t=>o.status=t),placeholder:"请选择状态",style:{width:"100%"}},{default:l(()=>[a(C,{label:"启用",value:"active"}),a(C,{label:"禁用",value:"inactive"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])]),_:1},8,["actions"])}}}),pa=Ke(ea,[["__scopeId","data-v-0aa92942"]]);export{pa as default};
